{"remainingRequest":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\University\\SoftDevTech\\Salary\\frontend\\src\\views\\Users.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\src\\views\\Users.vue","mtime":1638119261720},{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es6.array.find\";\nimport \"core-js/modules/es6.array.find-index\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"C:/University/SoftDevTech/Salary/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.string.starts-with\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Menu from \"@/views/components/Menu\";\nimport Header from \"@/views/components/Header\";\nimport UserService from \"@/services/user.service\";\nimport userEditor from \"@/views/components/userEditor\";\nexport default {\n  name: \"Users\",\n  data: function data() {\n    return {\n      message: '',\n      users: [],\n      selectedWorker: '',\n      selectedPosition: '',\n      selectedPositionId: '',\n      positionFocus: false,\n      workers: [],\n      positions: [],\n      isEditorActive: false,\n      userToEdit: {},\n      success: 0,\n      user: {\n        firstName: '',\n        profilePicture: '',\n        gender: false\n      }\n    };\n  },\n  components: {\n    'v-menu': Menu,\n    'v-header': Header,\n    'v-userEdit': userEditor\n  },\n  computed: {\n    filteredUsers: function filteredUsers() {\n      var _this = this;\n\n      return this.users.filter(function (i) {\n        return i.workerInfo.position.name.startsWith(_this.selectedPosition) && (i.firstName.startsWith(_this.selectedWorker) || i.lastName.startsWith(_this.selectedWorker) || i.patronymic.startsWith(_this.selectedWorker) || i.email.startsWith(_this.selectedWorker));\n      });\n    },\n    currentUser: function currentUser() {\n      return this.$store.state.auth.user;\n    },\n    isUserAdmin: function isUserAdmin() {\n      if (this.currentUser && this.currentUser.roles) {\n        return this.currentUser.roles.includes('ROLE_ADMIN');\n      }\n\n      return false;\n    },\n    isUserAccountant: function isUserAccountant() {\n      if (this.currentUser && this.currentUser.roles) {\n        return this.currentUser.roles.includes('ROLE_ACCOUNTANT');\n      }\n\n      return false;\n    }\n  },\n  methods: {\n    openEditor: function openEditor(user) {\n      this.userToEdit = user.id;\n      this.isEditorActive = true;\n    },\n    closeEditor: function closeEditor() {\n      this.isEditorActive = false;\n    },\n    scrollToUser: function () {\n      var _scrollToUser = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(number_slide) {\n        var slide, count, top, start_top, delta, i;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                slide = this.$refs['user' + number_slide][0];\n                count = 100;\n                top = window.scrollY + slide.getBoundingClientRect().y;\n                start_top = window.scrollY;\n                delta = (top - start_top) / count;\n                i = 0;\n\n              case 6:\n                if (!(i < count)) {\n                  _context.next = 13;\n                  break;\n                }\n\n                _context.next = 9;\n                return new Promise(function (resolve) {\n                  window.setTimeout(function () {\n                    resolve();\n                  }, 1000 / count);\n                });\n\n              case 9:\n                window.scrollTo(0, start_top + i * delta);\n\n              case 10:\n                i++;\n                _context.next = 6;\n                break;\n\n              case 13:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function scrollToUser(_x) {\n        return _scrollToUser.apply(this, arguments);\n      }\n\n      return scrollToUser;\n    }(),\n    successEdit: function successEdit(user) {\n      var _this2 = this;\n\n      this.closeEditor();\n      var index = this.users.findIndex(function (i) {\n        return i.id === user.id;\n      });\n      if (index === -1 && user.workerInfo) this.users.push(user); //if you want show SUCCESS message after add ACCOUNTANT, do it here\n      else this.users[index] = user;\n      this.success = user.id;\n      setTimeout(function () {\n        return _this2.success = 0;\n      }, 1500);\n    },\n    deactivatePositionFocus: function deactivatePositionFocus() {\n      var _this3 = this;\n\n      this.selectedPosition = this.selectedPosition && this.positions.find(function (i) {\n        return i.name.toLowerCase().startsWith(_this3.selectedPosition.toLowerCase());\n      }) ? this.positions.find(function (i) {\n        return i.name.toLowerCase().startsWith(_this3.selectedPosition.toLowerCase());\n      }).name : '';\n      this.selectedPositionId = this.selectedPosition && this.positions.find(function (i) {\n        return i.name.toLowerCase().startsWith(_this3.selectedPosition.toLowerCase());\n      }) ? this.positions.find(function (i) {\n        return i.name.toLowerCase().startsWith(_this3.selectedPosition.toLowerCase());\n      }).id : '';\n      this.positionFocus = false;\n    },\n    changeUser: function changeUser() {\n      var _this4 = this;\n\n      UserService.changeUser(this.currentUser.id, this.user).then(function (response) {\n        response.data;\n      }, function (error) {\n        _this4.message = error.response && error.response.data && error.response.data.message || error.message || error.toString();\n      });\n    },\n    deleteUser: function deleteUser(userId) {\n      var _this5 = this;\n\n      UserService.deleteUser(userId).then(function (response) {\n        response.data;\n\n        var index = _this5.users.findIndex(function (i) {\n          return i.id === userId;\n        });\n\n        _this5.users.splice(index, 1);\n      }, function (error) {\n        _this5.message = error.response && error.response.data && error.response.data.message || error.message || error.toString();\n      });\n    }\n  },\n  mounted: function mounted() {\n    var _this6 = this;\n\n    if (!this.currentUser) {\n      this.$router.push('/login');\n    }\n\n    UserService.getUser(this.currentUser.id).then(function (response) {\n      _this6.user = response.data;\n      _this6.user.birthday = new Date(response.data.birthday);\n    }, function (error) {\n      _this6.message = error.response && error.response.data && error.response.data.message || error.message || error.toString();\n    });\n    UserService.getAllUsers().then(function (response) {\n      _this6.users = response.data.filter(function (i) {\n        return i.workerInfo;\n      });\n    }, function (error) {\n      _this6.message = error.response && error.response.data && error.response.data.message || error.message || error.toString();\n    });\n    UserService.getPositions().then(function (response) {\n      _this6.positions = response.data;\n    }, function (error) {\n      _this6.message = error.response && error.response.data && error.response.data.message || error.message || error.toString();\n    });\n  },\n  updated: function updated() {\n    if (this.success) {\n      this.scrollToUser(this.success);\n    }\n  }\n};",{"version":3,"sources":["Users.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div v-if=\"currentUser\">\r\n    <v-header\r\n        v-bind:user=\"{\r\n        firstName: user.firstName,\r\n        profilePicture: user.profilePicture,\r\n        gender: user.gender\r\n      }\">\r\n    </v-header>\r\n\r\n    <v-userEdit v-if=\"isEditorActive\"\r\n                   :userToEdit = \"userToEdit\"\r\n                   :success = \"successEdit\"\r\n                   :close=\"closeEditor\"></v-userEdit>\r\n\r\n    <div class=\"container\">\r\n      <v-menu></v-menu>\r\n\r\n      <div class=\"content\" style=\"width: calc(80% - 15% - 285px + 245px)\">\r\n\r\n        <h1 class=\"h1\">Список пользователей</h1>\r\n        <div class=\"separator\"></div>\r\n        <div class=\"row\" style=\"align-items: flex-start;\">\r\n          <div class=\"column\">\r\n            <div class=\"row user-info\">Должность:</div>\r\n            <div class=\"row user-info\">Имя пользователя:</div>\r\n          </div>\r\n          <div class=\"column\" style=\"width: 300px\">\r\n            <div class=\"row\"  v-click-outside=\"deactivatePositionFocus\" style=\"margin: 8px 0; position: relative\">\r\n              <div style=\"position: relative; width: 100%\">\r\n                <input v-on:focus=\"positionFocus = true\" type=\"text\" class=\"border-input\" style=\"width: 100%\" v-model=\"selectedPosition\">\r\n                <span class=\"material-icons close-icon\" @click=\"selectedPosition=''; selectedPositionId='';\" style=\"position: absolute; top:calc(50% - 10px); right:18px;\">close</span>\r\n              </div>\r\n\r\n              <div v-if=\"positionFocus && positions.filter(i => i.name.toLowerCase().startsWith(selectedPosition.toLowerCase())).length\" class=\"input-select\">\r\n                <div v-for=\"position in positions.filter(i => i.name.toLowerCase().startsWith(selectedPosition.toLowerCase()))\" :key=\"position.id\" @click=\"selectedPosition=position.name; selectedPositionId=position.id; positionFocus=false; getAbsences()\">{{position.name}}</div>\r\n              </div>\r\n            </div>\r\n            <div class=\"row\" style=\"margin: 8px 0;\">\r\n              <div style=\"position: relative; width: 100%\">\r\n                <input type=\"text\" class=\"border-input\" style=\"width: 100%\" v-model=\"selectedWorker\">\r\n                <span class=\"material-icons close-icon\" @click=\"selectedWorker=''\" style=\"position: absolute; top:calc(50% - 10px); right:18px;\">close</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"row\" style=\"margin: 10px 15px 10px auto\"><div class=\"btn btn-thin\" style=\"margin: 0\" @click=\"openEditor({})\">Добавить пользователя</div></div>\r\n        </div>\r\n        <div class=\"separator\"></div>\r\n        <div class=\"row\">\r\n          <div v-if=\"users.length\" style=\"width: 100%;\">\r\n\r\n            <div class=\"userAbsences\" @click=\"openEditor(user)\"\r\n                 v-bind:style=\"success === user.id ? 'box-shadow: 0 2px 0 0 #a3dba8, 0 0 0 2px #b3eec1;': 'box-shadow: 0 1px 0 0 #dce1e6, 0 0 0 1px #e7e8ec;'\"\r\n                 :ref=\"'user'+user.id\"\r\n                 v-for=\"user in filteredUsers\" :key=\"user.id\">\r\n\r\n              <img :src=\"user.profilePicture ?\r\n                             require('../../public/images/store/'+user.profilePicture) :\r\n                             require('../../public/images/default'+(user.gender ? 'Woman':'Man')+'.png')\"\r\n                   v-bind:alt=\"user.firstName\"/>\r\n\r\n              <div class=\"column\" style=\"justify-content: space-between\">\r\n                <div style=\"margin-bottom: 12px; width: max-content\">{{user.lastName}} {{user.firstName}} {{user.patronymic}}</div>\r\n                <div style=\"width: max-content\">{{user.workerInfo ? user.workerInfo.position.name : 'Бухгалтер'}}</div>\r\n              </div>\r\n\r\n              <div style=\"margin-left: auto;\">\r\n                <span v-on:click.stop=\"deleteUser(user.id)\" class=\"material-icons close-icon\">close</span>\r\n              </div>\r\n            </div>\r\n\r\n          </div>\r\n          <div style=\"padding-left: 15px\" v-else>По выбранным критериям пользователей не найдено</div>\r\n        </div>\r\n\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Menu from \"@/views/components/Menu\";\r\nimport Header from \"@/views/components/Header\";\r\nimport UserService from \"@/services/user.service\";\r\nimport userEditor from \"@/views/components/userEditor\";\r\n\r\n\r\nexport default {\r\n  name: \"Users\",\r\n  data(){\r\n    return{\r\n      message: '',\r\n\r\n      users: [],\r\n\r\n      selectedWorker: '',\r\n\r\n      selectedPosition: '',\r\n      selectedPositionId: '',\r\n      positionFocus: false,\r\n\r\n      workers:[],\r\n      positions:[],\r\n\r\n      isEditorActive: false,\r\n      userToEdit:{},\r\n      success: 0,\r\n\r\n      user: {\r\n        firstName: '',\r\n        profilePicture: '',\r\n        gender: false\r\n      }\r\n    };\r\n  },\r\n  components:{\r\n    'v-menu' : Menu,\r\n    'v-header': Header,\r\n    'v-userEdit': userEditor\r\n  },\r\n  computed: {\r\n    filteredUsers(){\r\n      return this.users\r\n          .filter(\r\n              i => i.workerInfo.position.name.startsWith(this.selectedPosition)\r\n              && (\r\n                      i.firstName.startsWith(this.selectedWorker)\r\n                      || i.lastName.startsWith(this.selectedWorker)\r\n                      || i.patronymic.startsWith(this.selectedWorker)\r\n                      || i.email.startsWith(this.selectedWorker)\r\n\r\n                  )\r\n          )\r\n    },\r\n\r\n    currentUser() {\r\n      return this.$store.state.auth.user;\r\n    },\r\n    isUserAdmin() {\r\n      if (this.currentUser && this.currentUser.roles) {\r\n        return this.currentUser.roles.includes('ROLE_ADMIN');\r\n      }\r\n\r\n      return false;\r\n    },\r\n    isUserAccountant() {\r\n      if (this.currentUser && this.currentUser.roles) {\r\n        return this.currentUser.roles.includes('ROLE_ACCOUNTANT');\r\n      }\r\n\r\n      return false;\r\n    }\r\n  },\r\n  methods: {\r\n    openEditor(user){\r\n      this.userToEdit = user.id;\r\n      this.isEditorActive = true;\r\n    },\r\n    closeEditor(){\r\n      this.isEditorActive = false;\r\n    },\r\n    async scrollToUser(number_slide){\r\n      let slide = this.$refs['user'+number_slide][0]\r\n\r\n      let count = 100;\r\n      let top = window.scrollY + slide.getBoundingClientRect().y;\r\n      let start_top = window.scrollY;\r\n\r\n      let delta = (top - start_top) / count;\r\n      for (let i=0;i<count; i++) {\r\n        await new Promise(resolve => {\r\n          window.setTimeout(function () {\r\n            resolve()\r\n          }, 1000 / count)\r\n        })\r\n        window.scrollTo(0, start_top + i*delta)\r\n      }\r\n    },\r\n    successEdit(user){\r\n      this.closeEditor();\r\n      let index = this.users.findIndex(i => i.id === user.id);\r\n      if (index === -1 && user.workerInfo) this.users.push(user);//if you want show SUCCESS message after add ACCOUNTANT, do it here\r\n      else this.users[index] = user;\r\n\r\n\r\n      this.success = user.id;\r\n      setTimeout(()=>this.success=0,1500)\r\n    },\r\n\r\n\r\n\r\n    deactivatePositionFocus(){\r\n      this.selectedPosition = this.selectedPosition && this.positions.find(i => i.name.toLowerCase().startsWith(this.selectedPosition.toLowerCase())) ? this.positions.find(i => i.name.toLowerCase().startsWith(this.selectedPosition.toLowerCase())).name : ''\r\n      this.selectedPositionId = this.selectedPosition && this.positions.find(i => i.name.toLowerCase().startsWith(this.selectedPosition.toLowerCase())) ? this.positions.find(i => i.name.toLowerCase().startsWith(this.selectedPosition.toLowerCase())).id : ''\r\n      this.positionFocus = false;\r\n    },\r\n\r\n    changeUser(){\r\n      UserService.changeUser(this.currentUser.id, this.user).then(\r\n          response => {\r\n            response.data;\r\n          },\r\n          error => {\r\n            this.message =\r\n                (error.response && error.response.data && error.response.data.message) ||\r\n                error.message ||\r\n                error.toString();\r\n          }\r\n      );\r\n    },\r\n    deleteUser(userId){\r\n      UserService.deleteUser(userId).then(\r\n          response => {\r\n            response.data;\r\n            let index = this.users.findIndex(i => i.id === userId);\r\n            this.users.splice(index, 1);\r\n          },\r\n          error => {\r\n            this.message =\r\n                (error.response && error.response.data && error.response.data.message) ||\r\n                error.message ||\r\n                error.toString();\r\n          }\r\n      )\r\n    }\r\n  },\r\n  mounted() {\r\n    if (!this.currentUser) {\r\n      this.$router.push('/login');\r\n    }\r\n    UserService.getUser(this.currentUser.id).then(\r\n        response => {\r\n          this.user = response.data;\r\n          this.user.birthday = new Date(response.data.birthday);\r\n        },\r\n        error => {\r\n          this.message =\r\n              (error.response && error.response.data && error.response.data.message) ||\r\n              error.message ||\r\n              error.toString();\r\n        }\r\n    );\r\n    UserService.getAllUsers().then(\r\n        response => {\r\n          this.users = response.data.filter(i => i.workerInfo);\r\n        },\r\n        error => {\r\n          this.message =\r\n              (error.response && error.response.data && error.response.data.message) ||\r\n              error.message ||\r\n              error.toString();\r\n        }\r\n    );\r\n    UserService.getPositions().then(\r\n        response => {\r\n          this.positions = response.data;\r\n        },\r\n        error => {\r\n          this.message =\r\n              (error.response && error.response.data && error.response.data.message) ||\r\n              error.message ||\r\n              error.toString();\r\n        }\r\n    );\r\n  },\r\n  updated(){\r\n    if (this.success){\r\n      this.scrollToUser(this.success);\r\n    }\r\n  }\r\n}\r\n</script>"],"sourceRoot":"src/views"}]}