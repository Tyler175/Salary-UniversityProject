{"remainingRequest":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\University\\SoftDevTech\\Salary\\frontend\\src\\views\\Salary.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\src\\views\\Salary.vue","mtime":1638195085755},{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport \"core-js/modules/es6.array.sort\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Menu from \"@/views/components/Menu\";\nimport Header from \"@/views/components/Header\";\nimport UserService from \"@/services/user.service\";\nimport message from \"@/views/components/message\";\nimport DatePicker from 'vue2-datepicker';\nimport 'vue2-datepicker/index.css';\nimport 'vue2-datepicker/locale/es/ru.js';\nexport default {\n  name: \"Salary\",\n  data: function data() {\n    return {\n      message: '',\n      showMessage: false,\n      sortKey: \"\",\n      sortOrders: {},\n      searchQuery: \"\",\n      gridColumns: [\"name\", \"position\", \"absenceDays\", \"salary\", \"award\", \"result\"],\n      gridLocaleColumns: [\"ФИО\", \"Должность\", \"Пропуски\", \"Зарплата\", \"Премия\", \"Итого\"],\n      gridData: [],\n      gridData1: [{\n        name: \"Chuck Norris\",\n        power: Infinity\n      }, {\n        name: \"Bruce Lee\",\n        power: 9000\n      }, {\n        name: \"Jackie Chan\",\n        power: 7000\n      }, {\n        name: \"Jet Li\",\n        power: 8000\n      }],\n      selectedDate: new Date(new Date()),\n      premiumBudget: 0,\n      users: [],\n      user: {\n        firstName: '',\n        profilePicture: '',\n        gender: false\n      },\n      lang: {\n        formatLocale: {\n          months: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь']\n        }\n      }\n    };\n  },\n  components: {\n    DatePicker: DatePicker,\n    'v-menu': Menu,\n    'v-header': Header,\n    'v-message': message\n  },\n  computed: {\n    remainPremiumBudget: function remainPremiumBudget() {\n      var res = this.premiumBudget;\n      this.gridData.forEach(function (i) {\n        return res -= i.award.amount;\n      });\n      return res;\n    },\n    filteredHeroes: function filteredHeroes() {\n      var sortKey = this.sortKey;\n      var filterKey = this.searchQuery && this.searchQuery.toLowerCase();\n      var order = this.sortOrders[sortKey] || 1;\n      var heroes = this.gridData;\n\n      if (filterKey) {\n        heroes = heroes.filter(function (row) {\n          return Object.keys(row).some(function (key) {\n            return String(row[key]).toLowerCase().indexOf(filterKey) > -1;\n          });\n        });\n      }\n\n      if (sortKey) {\n        heroes = heroes.slice().sort(function (a, b) {\n          a = a[sortKey];\n          b = b[sortKey];\n          return (a === b ? 0 : a > b ? 1 : -1) * order;\n        });\n      }\n\n      return heroes;\n    },\n    currentUser: function currentUser() {\n      return this.$store.state.auth.user;\n    },\n    isUserAdmin: function isUserAdmin() {\n      if (this.currentUser && this.currentUser.roles) {\n        return this.currentUser.roles.includes('ROLE_ADMIN');\n      }\n\n      return false;\n    },\n    isUserAccountant: function isUserAccountant() {\n      if (this.currentUser && this.currentUser.roles) {\n        return this.currentUser.roles.includes('ROLE_ACCOUNTANT');\n      }\n\n      return false;\n    }\n  },\n  filters: {\n    capitalize: function capitalize(str) {\n      return str.charAt(0).toUpperCase() + str.slice(1);\n    }\n  },\n  methods: {\n    close: function close() {\n      this.showMessage = false;\n      this.message = '';\n    },\n    changeSalary: function changeSalary(user) {\n      var _this = this;\n\n      if (this.remainPremiumBudget < 0) {\n        user.award.amount = 0;\n        this.message = \"Вы вышли за пределы премиального бюджета\";\n        this.showMessage = true;\n      }\n\n      user.result = ((parseFloat(user.salary) + parseFloat(user.award.amount)) * 0.87).toFixed(2);\n      user.award.month = this.selectedDate;\n      UserService.changeAwards(user).then(function (response) {\n        user.award = response.data;\n      }, function (error) {\n        _this.message = error.response && error.response.data && error.response.data.message || error.message || error.toString();\n      });\n    },\n    isFloat: function isFloat(n) {\n      return Number(n) === n && n % 1 !== 0;\n    },\n    sortBy: function sortBy(index) {\n      var key = this.gridColumns[index];\n      this.sortKey = key;\n      this.sortOrders[key] = this.sortOrders[key] * -1;\n    },\n    changeUser: function changeUser() {\n      var _this2 = this;\n\n      UserService.changeUser(this.currentUser.id, this.user).then(function (response) {\n        response.data;\n      }, function (error) {\n        _this2.message = error.response && error.response.data && error.response.data.message || error.message || error.toString();\n      });\n    },\n    getSalary: function getSalary() {\n      var _this3 = this;\n\n      UserService.getSalary(this.selectedDate).then(function (response) {\n        _this3.gridData = _this3.isUserAccountant ? response.data : response.data.filter(function (i) {\n          return i.id === _this3.currentUser.id;\n        });\n\n        _this3.gridData.forEach(function (i) {\n          return i.result = (i.salary + i.award.amount) * 0.87;\n        });\n      }, function (error) {\n        _this3.message = error.response && error.response.data && error.response.data.message || error.message || error.toString();\n      });\n      UserService.getBudget(this.selectedDate).then(function (response) {\n        _this3.premiumBudget = response.data.amount;\n      }, function (error) {\n        _this3.message = error.response && error.response.data && error.response.data.message || error.message || error.toString();\n      });\n    }\n  },\n  mounted: function mounted() {\n    var _this4 = this;\n\n    if (!this.currentUser) {\n      this.$router.push('/login');\n    }\n\n    var sortOrders = {};\n    this.gridColumns.forEach(function (key) {\n      sortOrders[key] = 1;\n    });\n    this.sortOrders = sortOrders;\n    UserService.getUser(this.currentUser.id).then(function (response) {\n      _this4.user = response.data;\n      _this4.user.birthday = new Date(response.data.birthday);\n    }, function (error) {\n      _this4.message = error.response && error.response.data && error.response.data.message || error.message || error.toString();\n    });\n    this.getSalary();\n  }\n};",{"version":3,"sources":["Salary.vue"],"names":[],"mappings":"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","sourcesContent":["<style scoped>\r\n  .mx-datepicker{\r\n    width: fit-content;\r\n  }\r\n  input:disabled{\r\n    background: none;\r\n  }\r\n</style>\r\n<template>\r\n  <div v-if=\"currentUser\">\r\n    <v-header\r\n        v-bind:user=\"{\r\n        firstName: user.firstName,\r\n        profilePicture: user.profilePicture,\r\n        gender: user.gender\r\n      }\">\r\n    </v-header>\r\n\r\n    <v-message v-if=\"showMessage\" :message=\"message\" :close=\"close\"></v-message>\r\n\r\n    <div class=\"container\">\r\n      <v-menu></v-menu>\r\n\r\n      <div class=\"content\" style=\"width: calc(80% - 15% - 285px + 245px)\">\r\n        <h1 class=\"h1\">Распределение зарплат</h1>\r\n        <div class=\"separator\"></div>\r\n        <div class=\"row\" style=\"align-items: flex-start;\">\r\n\r\n          <div class=\"row user-info\">Месяц:</div>\r\n          <div class=\"row\" style=\"margin: 8px 0\">\r\n            <date-picker v-model=\"selectedDate\"\r\n                         @change=\"getSalary\"\r\n                         style=\"outline: 0;\r\n                              width: 200px;\r\n                              border: 1px solid #dce1e6;\r\n                              border-radius: 3px;\r\n                              padding: 6px 12px;\"\r\n                         type=\"month\"\r\n                         format=\"MMMM YYYY\"\r\n                         :lang=\"lang\"\r\n                         :clearable = \"false\"\r\n                         input-class=\"date-picker\"\r\n                         placeholder=\"Выбрать\">\r\n            </date-picker>\r\n          </div>\r\n          <div v-if=\"isUserAccountant\" class=\"column\" style=\"margin-left: 50px\">\r\n            <div class=\"row\">\r\n              <div class=\"user-info\">Премиальный бюджет:</div> <span>{{premiumBudget}}</span>\r\n            </div>\r\n            <div class=\"row\">\r\n              <div class=\"user-info\">Остаток:</div> <span>{{remainPremiumBudget}}</span>\r\n            </div>\r\n\r\n\r\n          </div>\r\n          <div v-else class=\"column\" style=\"margin-left: 50px\">\r\n            <div class=\"row\">\r\n              <div class=\"user-info\">Плановые дни:</div> <span>21</span>\r\n            </div>\r\n            <div class=\"row\">\r\n              <div class=\"user-info\">Фактические дни:</div> <span>17</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"separator\"></div>\r\n\r\n        <table class=\"table\">\r\n          <thead class=\"thead\">\r\n          <tr class=\"tr\">\r\n            <th class=\"th\" v-for=\"(key, index) in gridLocaleColumns\"\r\n                :key=\"index\"\r\n                @click=\"sortBy(index)\"\r\n                :class=\"{ active: sortKey == gridColumns[index] }\">\r\n              {{ key | capitalize }}\r\n              <span class=\"arrow\" :class=\"sortOrders[gridColumns[index]] > 0 ? 'asc' : 'dsc'\">\r\n              </span>\r\n            </th>\r\n          </tr>\r\n          </thead>\r\n          <tbody class=\"tbody\">\r\n          <tr class=\"tr\" v-for=\"(entry, entryIndex) in filteredHeroes\"\r\n            :key = \"entryIndex\">\r\n            <td class=\"td\" v-for=\"(key, index) in gridColumns\" :key = \"index\">\r\n              <div v-if=\"key!=='award'\">{{isFloat(entry[key]) ? (entry[key]).toFixed(2) : (entry[key])}}</div>\r\n              <input v-else :disabled=\"!isUserAccountant\" class=\"table-input\" type=\"number\" v-model=\"entry[key].amount\" @input=\"changeSalary(entry)\">\r\n            </td>\r\n          </tr>\r\n          </tbody>\r\n        </table>\r\n\r\n\r\n\r\n\r\n\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Menu from \"@/views/components/Menu\";\r\nimport Header from \"@/views/components/Header\";\r\nimport UserService from \"@/services/user.service\";\r\nimport message from \"@/views/components/message\";\r\n\r\nimport DatePicker from 'vue2-datepicker';\r\nimport 'vue2-datepicker/index.css';\r\nimport 'vue2-datepicker/locale/es/ru.js';\r\n\r\n\r\nexport default {\r\n  name: \"Salary\",\r\n  data(){\r\n\r\n    return{\r\n      message: '',\r\n\r\n      showMessage: false,\r\n\r\n      sortKey: \"\",\r\n      sortOrders: {},\r\n      searchQuery: \"\",\r\n      gridColumns: [\"name\", \"position\", \"absenceDays\", \"salary\", \"award\", \"result\"],\r\n      gridLocaleColumns: [\"ФИО\", \"Должность\", \"Пропуски\", \"Зарплата\", \"Премия\", \"Итого\"],\r\n\r\n      gridData: [],\r\n      gridData1: [\r\n        { name: \"Chuck Norris\", power: Infinity },\r\n        { name: \"Bruce Lee\", power: 9000 },\r\n        { name: \"Jackie Chan\", power: 7000 },\r\n        { name: \"Jet Li\", power: 8000 }\r\n      ],\r\n\r\n      selectedDate: new Date(new Date()),\r\n\r\n      premiumBudget: 0,\r\n\r\n      users: [],\r\n\r\n      user:{\r\n        firstName: '',\r\n        profilePicture: '',\r\n        gender: false\r\n      },\r\n\r\n      lang: {\r\n        formatLocale: {\r\n          months: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'],\r\n        }\r\n      }\r\n    };\r\n  },\r\n  components:{\r\n    DatePicker,\r\n    'v-menu' : Menu,\r\n    'v-header': Header,\r\n    'v-message': message\r\n  },\r\n  computed: {\r\n    remainPremiumBudget(){\r\n      let res = this.premiumBudget\r\n      this.gridData.forEach(i => res-=i.award.amount);\r\n      return res;\r\n    },\r\n\r\n    filteredHeroes: function() {\r\n      var sortKey = this.sortKey;\r\n      var filterKey = this.searchQuery && this.searchQuery.toLowerCase();\r\n      var order = this.sortOrders[sortKey] || 1;\r\n      var heroes = this.gridData;\r\n      if (filterKey) {\r\n        heroes = heroes.filter(function(row) {\r\n          return Object.keys(row).some(function(key) {\r\n            return (\r\n                String(row[key])\r\n                    .toLowerCase()\r\n                    .indexOf(filterKey) > -1\r\n            );\r\n          });\r\n        });\r\n      }\r\n      if (sortKey) {\r\n        heroes = heroes.slice().sort(function(a, b) {\r\n          a = a[sortKey];\r\n          b = b[sortKey];\r\n          return (a === b ? 0 : a > b ? 1 : -1) * order;\r\n        });\r\n      }\r\n      return heroes;\r\n    },\r\n\r\n    currentUser() {\r\n      return this.$store.state.auth.user;\r\n    },\r\n    isUserAdmin() {\r\n      if (this.currentUser && this.currentUser.roles) {\r\n        return this.currentUser.roles.includes('ROLE_ADMIN');\r\n      }\r\n\r\n      return false;\r\n    },\r\n    isUserAccountant() {\r\n      if (this.currentUser && this.currentUser.roles) {\r\n        return this.currentUser.roles.includes('ROLE_ACCOUNTANT');\r\n      }\r\n\r\n      return false;\r\n    }\r\n  },\r\n  filters: {\r\n    capitalize: function(str) {\r\n      return str.charAt(0).toUpperCase() + str.slice(1);\r\n    }\r\n  },\r\n  methods: {\r\n    close(){\r\n      this.showMessage = false;\r\n      this.message = ''\r\n    },\r\n    changeSalary(user){\r\n      if (this.remainPremiumBudget < 0){\r\n        user.award.amount = 0;\r\n        this.message = \"Вы вышли за пределы премиального бюджета\"\r\n        this.showMessage = true;\r\n      }\r\n      user.result = ((parseFloat(user.salary) + parseFloat(user.award.amount))*0.87).toFixed(2);\r\n      user.award.month = this.selectedDate;\r\n      UserService.changeAwards(user).then(\r\n          response => {\r\n            user.award = response.data;\r\n          },\r\n          error=>{\r\n            this.message =\r\n                (error.response && error.response.data && error.response.data.message) ||\r\n                error.message ||\r\n                error.toString();\r\n          }\r\n      )\r\n\r\n    },\r\n    isFloat(n){\r\n      return Number(n) === n && n % 1 !== 0;\r\n    },\r\n    sortBy: function(index) {\r\n      let key = this.gridColumns[index];\r\n      this.sortKey = key;\r\n      this.sortOrders[key] = this.sortOrders[key] * -1;\r\n    },\r\n    changeUser(){\r\n      UserService.changeUser(this.currentUser.id, this.user).then(\r\n          response => {\r\n            response.data;\r\n          },\r\n          error => {\r\n            this.message =\r\n                (error.response && error.response.data && error.response.data.message) ||\r\n                error.message ||\r\n                error.toString();\r\n          }\r\n      );\r\n    },\r\n\r\n\r\n    getSalary(){\r\n      UserService.getSalary(this.selectedDate).then(\r\n          response => {\r\n            this.gridData = this.isUserAccountant ? response.data : response.data.filter(i => i.id === this.currentUser.id);\r\n\r\n            this.gridData.forEach(i => i.result = (i.salary + i.award.amount)*0.87)\r\n          },\r\n          error => {\r\n            this.message =\r\n                (error.response && error.response.data && error.response.data.message) ||\r\n                error.message ||\r\n                error.toString();\r\n          }\r\n      );\r\n      UserService.getBudget(this.selectedDate).then(\r\n          response => {\r\n            this.premiumBudget = response.data.amount;\r\n          },\r\n          error => {\r\n            this.message =\r\n                (error.response && error.response.data && error.response.data.message) ||\r\n                error.message ||\r\n                error.toString();\r\n          }\r\n      );\r\n    }\r\n  },\r\n  mounted() {\r\n    if (!this.currentUser) {\r\n      this.$router.push('/login');\r\n    }\r\n\r\n    let sortOrders = {};\r\n    this.gridColumns.forEach(function(key) {\r\n      sortOrders[key] = 1;\r\n    });\r\n    this.sortOrders = sortOrders;\r\n\r\n    UserService.getUser(this.currentUser.id).then(\r\n        response => {\r\n          this.user = response.data;\r\n          this.user.birthday = new Date(response.data.birthday);\r\n        },\r\n        error => {\r\n          this.message =\r\n              (error.response && error.response.data && error.response.data.message) ||\r\n              error.message ||\r\n              error.toString();\r\n        }\r\n    );\r\n    this.getSalary();\r\n  }\r\n}\r\n</script>"],"sourceRoot":"src/views"}]}