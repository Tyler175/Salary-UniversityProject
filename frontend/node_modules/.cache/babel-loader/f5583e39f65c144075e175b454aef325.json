{"remainingRequest":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\University\\SoftDevTech\\Salary\\frontend\\src\\views\\Absences.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\src\\views\\Absences.vue","mtime":1638120451113},{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.find-index\";\nimport \"core-js/modules/es6.array.sort\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.regexp.to-string\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"C:/University/SoftDevTech/Salary/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.string.starts-with\";\nimport \"core-js/modules/es6.array.find\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Menu from \"@/views/components/Menu\";\nimport Header from \"@/views/components/Header\";\nimport UserService from \"@/services/user.service\";\nimport absenceEditor from \"@/views/components/absenceEditor\";\nimport DatePicker from 'vue2-datepicker';\nimport 'vue2-datepicker/index.css';\nimport 'vue2-datepicker/locale/es/ru.js';\nexport default {\n  name: \"Absences\",\n  data: function data() {\n    return {\n      message: '',\n      test: '',\n      selectedDates: [new Date(new Date()), new Date(new Date())],\n      isEditorActive: false,\n      absenceToEdit: {},\n      userToEdit: {},\n      success: 0,\n      selectedWorker: '',\n      selectedWorkerId: '',\n      workerFocus: false,\n      selectedPosition: '',\n      selectedPositionId: '',\n      positionFocus: false,\n      workers: [],\n      positions: [],\n      usersAbsences: [],\n      user: {\n        firstName: '',\n        profilePicture: '',\n        gender: false\n      },\n      lang: {\n        formatLocale: {\n          months: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь']\n        }\n      }\n    };\n  },\n  components: {\n    DatePicker: DatePicker,\n    'v-menu': Menu,\n    'v-header': Header,\n    'v-absenceEdit': absenceEditor\n  },\n  computed: {\n    currentUser: function currentUser() {\n      return this.$store.state.auth.user;\n    },\n    isUserAdmin: function isUserAdmin() {\n      if (this.currentUser && this.currentUser.roles) {\n        return this.currentUser.roles.includes('ROLE_ADMIN');\n      }\n\n      return false;\n    },\n    isUserAccountant: function isUserAccountant() {\n      if (this.currentUser && this.currentUser.roles) {\n        return this.currentUser.roles.includes('ROLE_ACCOUNTANT');\n      }\n\n      return false;\n    }\n  },\n  methods: {\n    deactivateWorkerFocus: function deactivateWorkerFocus() {\n      this.selectedWorker = this.workers.length && this.selectedWorker ? this.workers[0].lastName + ' ' + this.workers[0].firstName + ' ' + this.workers[0].patronymic : '';\n      this.selectedWorkerId = this.workers.length && this.selectedWorker ? this.workers[0].id : '';\n      this.workerFocus = false;\n    },\n    deactivatePositionFocus: function deactivatePositionFocus() {\n      var _this = this;\n\n      this.selectedPosition = this.selectedPosition && this.positions.find(function (i) {\n        return i.name.toLowerCase().startsWith(_this.selectedPosition.toLowerCase());\n      }) ? this.positions.find(function (i) {\n        return i.name.toLowerCase().startsWith(_this.selectedPosition.toLowerCase());\n      }).name : '';\n      this.selectedPositionId = this.selectedPosition && this.positions.find(function (i) {\n        return i.name.toLowerCase().startsWith(_this.selectedPosition.toLowerCase());\n      }) ? this.positions.find(function (i) {\n        return i.name.toLowerCase().startsWith(_this.selectedPosition.toLowerCase());\n      }).id : '';\n      this.positionFocus = false;\n    },\n    openEditor: function openEditor(absence, user) {\n      this.absenceToEdit = absence;\n      this.userToEdit = user ? user.id : '';\n      this.isEditorActive = true;\n    },\n    closeEditor: function closeEditor() {\n      this.isEditorActive = false;\n    },\n    scrollToAbsence: function () {\n      var _scrollToAbsence = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(number_slide) {\n        var slide, count, top, start_top, delta, i;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                slide = this.$refs['absence' + number_slide][0];\n                count = 100;\n                top = window.scrollY + slide.getBoundingClientRect().y;\n                start_top = window.scrollY;\n                delta = (top - start_top) / count;\n                i = 0;\n\n              case 6:\n                if (!(i < count)) {\n                  _context.next = 13;\n                  break;\n                }\n\n                _context.next = 9;\n                return new Promise(function (resolve) {\n                  window.setTimeout(function () {\n                    resolve();\n                  }, 1000 / count);\n                });\n\n              case 9:\n                window.scrollTo(0, start_top + i * delta);\n\n              case 10:\n                i++;\n                _context.next = 6;\n                break;\n\n              case 13:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function scrollToAbsence(_x) {\n        return _scrollToAbsence.apply(this, arguments);\n      }\n\n      return scrollToAbsence;\n    }(),\n    successEdit: function successEdit(userId, absence) {\n      var _this2 = this;\n\n      this.closeEditor();\n      var changedAbsences = this.usersAbsences.find(function (i) {\n        return i.id === userId;\n      }).workerInfo.absences;\n      if (!changedAbsences.find(function (i) {\n        return i.id === absence.id;\n      })) changedAbsences.push(absence);\n      this.success = absence.id;\n      setTimeout(function () {\n        return _this2.success = 0;\n      }, 1500);\n    },\n    getUsersByName: function getUsersByName() {\n      var _this3 = this;\n\n      UserService.getUsersByName(this.selectedWorker).then(function (response) {\n        _this3.workers = response.data.filter(function (i) {\n          return i.workerInfo;\n        });\n      }, function (error) {\n        _this3.message = error.response && error.response.data && error.response.data.message || error.message || error.toString();\n      });\n    },\n    getAbsences: function getAbsences() {\n      var _this4 = this;\n\n      UserService.getAbsences(this.isUserAccountant ? this.selectedWorkerId : this.currentUser.id, this.selectedPositionId, this.selectedDates[0], this.selectedDates[1]).then(function (response) {\n        _this4.usersAbsences = response.data;\n\n        _this4.usersAbsences.forEach(function (i) {\n          return i.workerInfo.absences.sort(function (a1, a2) {\n            return new Date(a1.startDate).getTime() - new Date(a2.startDate).getTime();\n          });\n        });\n      }, function (error) {\n        _this4.message = error.response && error.response.data && error.response.data.message || error.message || error.toString();\n      });\n    },\n    deleteAbsence: function deleteAbsence(userId, absenceId) {\n      var _this5 = this;\n\n      UserService.deleteAbsence(absenceId).then(function (response) {\n        response.data;\n\n        var index = _this5.usersAbsences.find(function (i) {\n          return i.id === userId;\n        }).workerInfo.absences.findIndex(function (i) {\n          return i.id === absenceId;\n        });\n\n        _this5.usersAbsences.find(function (i) {\n          return i.id === userId;\n        }).workerInfo.absences.splice(index, 1);\n      }, function (error) {\n        _this5.message = error.response && error.response.data && error.response.data.message || error.message || error.toString();\n      });\n    }\n  },\n  mounted: function mounted() {\n    var _this6 = this;\n\n    if (!this.currentUser) {\n      this.$router.push('/login');\n    }\n\n    UserService.getUser(this.currentUser.id).then(function (response) {\n      _this6.user = response.data;\n      _this6.user.birthday = new Date(response.data.birthday);\n    }, function (error) {\n      _this6.message = error.response && error.response.data && error.response.data.message || error.message || error.toString();\n    });\n    UserService.getPositions().then(function (response) {\n      _this6.positions = response.data;\n    }, function (error) {\n      _this6.message = error.response && error.response.data && error.response.data.message || error.message || error.toString();\n    });\n    this.getAbsences();\n  },\n  updated: function updated() {\n    if (this.success) {\n      this.scrollToAbsence(this.success);\n    }\n  }\n};",{"version":3,"sources":["Absences.vue"],"names":[],"mappings":"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","sourcesContent":["<style scoped>\r\n  .mx-datepicker{\r\n    width: fit-content;\r\n  }\r\n  .user-info{\r\n    width: fit-content;\r\n    margin-right: 15px;\r\n  }\r\n\r\n</style>\r\n<template>\r\n  <div v-if=\"currentUser\">\r\n    <v-header\r\n        v-bind:user=\"{\r\n        firstName: user.firstName,\r\n        profilePicture: user.profilePicture,\r\n        gender: user.gender\r\n      }\">\r\n    </v-header>\r\n\r\n    <v-absenceEdit v-if=\"isEditorActive\"\r\n                   :absence=\"absenceToEdit\"\r\n                   :userToEdit = \"userToEdit\"\r\n                   :success = \"successEdit\"\r\n                   :close=\"closeEditor\"\r\n                   :isUserAccountant=\"isUserAccountant\"></v-absenceEdit>\r\n\r\n    <div class=\"container\">\r\n      <v-menu></v-menu>\r\n\r\n      <div class=\"content\" style=\"width: calc(80% - 15% - 285px + 245px);\">\r\n        <h1 class=\"h1\">Пропуски работы</h1>\r\n        <div class=\"separator\"></div>\r\n        <div class=\"row\" style=\"align-items: flex-start\">\r\n          <div class=\"column\">\r\n            <div class=\"row user-info\">Показать пропуски за период:</div>\r\n            <div v-if=\"isUserAccountant\" class=\"row user-info\">Сотрудник:</div>\r\n            <div v-if=\"isUserAccountant\" class=\"row user-info\">Должность:</div>\r\n          </div>\r\n          <div class=\"column\">\r\n            <div class=\"row\" style=\"margin: 8px 0\">\r\n              <date-picker v-model=\"selectedDates\"\r\n                           @change=\"getAbsences\"\r\n                           style=\"outline: 0;\r\n                              width: 280px;\r\n                              border: 1px solid #dce1e6;\r\n                              border-radius: 3px;\r\n                              padding: 6px 12px;\"\r\n                           type=\"month\"\r\n                           :range=true\r\n                           range-separator = \" - \"\r\n                           format=\"MMMM YYYY\"\r\n                           :lang=\"lang\"\r\n                           :clearable = \"false\"\r\n                           input-class=\"date-picker kludge\"\r\n                           placeholder=\"Выбрать\">\r\n              </date-picker>\r\n            </div>\r\n            <!-- it should be the component because you copy paste this fragment at least three times-->\r\n            <div v-if=\"isUserAccountant\" class=\"row\" v-click-outside=\"deactivateWorkerFocus\" style=\"margin: 8px 0; position: relative\">\r\n              <div style=\"position: relative; width: 100%\">\r\n                <input v-on:focus=\"workerFocus = true\" type=\"text\" class=\"border-input\" style=\"width: 100%\" v-model=\"selectedWorker\" @input=\"getUsersByName()\">\r\n                <span class=\"material-icons close-icon\" @click=\"selectedWorker=''; selectedWorkerId=''; getAbsences()\" style=\"position: absolute; top:calc(50% - 10px); right:18px;\">close</span>\r\n              </div>\r\n\r\n              <div v-if=\"selectedWorker && workerFocus && workers.length\" class=\"input-select\">\r\n                <div v-for=\"worker in workers\" :key=\"worker.id\" @click=\"selectedWorker=worker.firstName+worker.lastName+worker.patronymic; selectedWorkerId=worker.id; workerFocus=false; getAbsences()\">\r\n                  {{worker.lastName}} {{worker.firstName}} {{worker.patronymic}}\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div v-if=\"isUserAccountant\" class=\"row\" v-click-outside=\"deactivatePositionFocus\" style=\"margin: 8px 0; position: relative\">\r\n              <div style=\"position: relative; width: 100%\">\r\n                <input v-on:focus=\"positionFocus = true\" type=\"text\" class=\"border-input\" style=\"width: 100%\" v-model=\"selectedPosition\">\r\n                <span class=\"material-icons close-icon\" @click=\"selectedPosition=''; selectedPositionId=''; getAbsences()\" style=\"position: absolute; top:calc(50% - 10px); right:18px;\">close</span>\r\n              </div>\r\n\r\n              <div v-if=\"positionFocus && positions.filter(i => i.name.toLowerCase().startsWith(selectedPosition.toLowerCase())).length\" class=\"input-select\">\r\n                <div v-for=\"position in positions.filter(i => i.name.toLowerCase().startsWith(selectedPosition.toLowerCase()))\" :key=\"position.id\" @click=\"selectedPosition=position.name; selectedPositionId=position.id; positionFocus=false; getAbsences()\">{{position.name}}</div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"row\" style=\"margin: 10px 15px 10px auto\"><div class=\"btn btn-thin\" style=\"margin: 0\" @click=\"openEditor({})\">Добавить информацию о пропусках</div></div>\r\n        </div>\r\n\r\n        <div class=\"separator\"></div>\r\n        <div class=\"row\">\r\n          <div v-if=\"usersAbsences.length\" style=\"width: 100%;\">\r\n            <div v-for=\"userAbsences in usersAbsences\" :key=\"userAbsences.id\">\r\n              <div class=\"userAbsences\" @click=\"openEditor(absence, userAbsences)\"\r\n                   v-bind:style=\"success === absence.id ? 'box-shadow: 0 2px 0 0 #a3dba8, 0 0 0 2px #b3eec1;': 'box-shadow: 0 1px 0 0 #dce1e6, 0 0 0 1px #e7e8ec;'\"\r\n                   :ref=\"'absence'+absence.id\"\r\n                   v-for=\"absence in userAbsences.workerInfo.absences\" :key=\"absence.id\">\r\n\r\n                <img :src=\"userAbsences.profilePicture ?\r\n                             require('../../public/images/store/'+userAbsences.profilePicture) :\r\n                             require('../../public/images/default'+(userAbsences.gender ? 'Woman':'Man')+'.png')\"\r\n                     v-bind:alt=\"userAbsences.firstName\"/>\r\n\r\n                <div class=\"column\" style=\"justify-content: space-between\">\r\n                  <div style=\"margin-bottom: 12px; width: max-content\">{{userAbsences.lastName}} {{userAbsences.firstName}} {{userAbsences.patronymic}}</div>\r\n                  <div style=\"width: max-content\">{{new Date(absence.startDate).toLocaleDateString()}} - {{new Date(absence.endDate).toLocaleDateString()}}</div>\r\n                </div>\r\n                <div style=\"margin-left: 30px\">Причина:</div>\r\n                <div style=\"margin-left: 10px; white-space: pre\">{{absence.reason}}</div>\r\n                <div style=\"margin-left: auto;\">\r\n                  <span v-on:click.stop=\"deleteAbsence(userAbsences.id,absence.id)\" class=\"material-icons close-icon\">close</span>\r\n                </div>\r\n              </div>\r\n\r\n            </div>\r\n          </div>\r\n          <div style=\"padding-left: 15px\" v-else>За данный период пропусков не было</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Menu from \"@/views/components/Menu\";\r\nimport Header from \"@/views/components/Header\";\r\nimport UserService from \"@/services/user.service\";\r\nimport absenceEditor from \"@/views/components/absenceEditor\";\r\n\r\nimport DatePicker from 'vue2-datepicker';\r\nimport 'vue2-datepicker/index.css';\r\nimport 'vue2-datepicker/locale/es/ru.js';\r\n\r\n\r\nexport default {\r\n  name: \"Absences\",\r\n  data(){\r\n    return{\r\n      message: '',\r\n      test: '',\r\n\r\n      selectedDates: [new Date(new Date()),new Date(new Date())],\r\n\r\n      isEditorActive: false,\r\n      absenceToEdit: {},\r\n      userToEdit:{},\r\n      success: 0,\r\n\r\n      selectedWorker: '',\r\n      selectedWorkerId: '',\r\n      workerFocus: false,\r\n\r\n      selectedPosition: '',\r\n      selectedPositionId: '',\r\n      positionFocus: false,\r\n\r\n      workers:[],\r\n      positions:[],\r\n      usersAbsences: [],\r\n\r\n      user:{\r\n        firstName: '',\r\n        profilePicture: '',\r\n        gender: false\r\n      },\r\n\r\n      lang: {\r\n        formatLocale: {\r\n          months: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'],\r\n        }\r\n      }\r\n    };\r\n  },\r\n  components:{\r\n    DatePicker,\r\n    'v-menu' : Menu,\r\n    'v-header': Header,\r\n    'v-absenceEdit': absenceEditor\r\n  },\r\n  computed: {\r\n    currentUser() {\r\n      return this.$store.state.auth.user;\r\n    },\r\n    isUserAdmin() {\r\n      if (this.currentUser && this.currentUser.roles) {\r\n        return this.currentUser.roles.includes('ROLE_ADMIN');\r\n      }\r\n\r\n      return false;\r\n    },\r\n    isUserAccountant() {\r\n      if (this.currentUser && this.currentUser.roles) {\r\n        return this.currentUser.roles.includes('ROLE_ACCOUNTANT');\r\n      }\r\n\r\n      return false;\r\n    }\r\n  },\r\n  methods: {\r\n    deactivateWorkerFocus(){\r\n      this.selectedWorker = this.workers.length && this.selectedWorker ? this.workers[0].lastName + ' ' + this.workers[0].firstName + ' ' + this.workers[0].patronymic : '';\r\n      this.selectedWorkerId = this.workers.length && this.selectedWorker ? this.workers[0].id : '';\r\n      this.workerFocus = false;\r\n    },\r\n    deactivatePositionFocus(){\r\n      this.selectedPosition = this.selectedPosition && this.positions.find(i => i.name.toLowerCase().startsWith(this.selectedPosition.toLowerCase())) ? this.positions.find(i => i.name.toLowerCase().startsWith(this.selectedPosition.toLowerCase())).name : ''\r\n      this.selectedPositionId = this.selectedPosition && this.positions.find(i => i.name.toLowerCase().startsWith(this.selectedPosition.toLowerCase())) ? this.positions.find(i => i.name.toLowerCase().startsWith(this.selectedPosition.toLowerCase())).id : ''\r\n      this.positionFocus = false;\r\n    },\r\n\r\n    openEditor(absence, user){\r\n      this.absenceToEdit = absence;\r\n      this.userToEdit = user ? user.id : '';\r\n      this.isEditorActive = true;\r\n    },\r\n    closeEditor(){\r\n      this.isEditorActive = false;\r\n    },\r\n    async scrollToAbsence(number_slide){\r\n      let slide = this.$refs['absence'+number_slide][0]\r\n\r\n      let count = 100;\r\n      let top = window.scrollY + slide.getBoundingClientRect().y;\r\n      let start_top = window.scrollY;\r\n\r\n      let delta = (top - start_top) / count;\r\n      for (let i=0;i<count; i++) {\r\n        await new Promise(resolve => {\r\n          window.setTimeout(function () {\r\n            resolve()\r\n          }, 1000 / count)\r\n        })\r\n        window.scrollTo(0, start_top + i*delta)\r\n      }\r\n    },\r\n    successEdit(userId, absence){\r\n      this.closeEditor();\r\n      let changedAbsences = this.usersAbsences.find(i => i.id === userId).workerInfo.absences;\r\n      if (!changedAbsences.find(i => i.id === absence.id)) changedAbsences.push(absence);\r\n\r\n\r\n      this.success = absence.id;\r\n      setTimeout(()=>this.success=0,1500)\r\n    },\r\n\r\n\r\n    getUsersByName(){\r\n      UserService.getUsersByName(this.selectedWorker).then(\r\n          response => {\r\n            this.workers = response.data.filter(i => i.workerInfo);\r\n          },\r\n          error => {\r\n            this.message =\r\n                (error.response && error.response.data && error.response.data.message) ||\r\n                error.message ||\r\n                error.toString();\r\n          }\r\n      );\r\n    },\r\n\r\n    getAbsences(){\r\n      UserService.getAbsences(this.isUserAccountant ? this.selectedWorkerId : this.currentUser.id, this.selectedPositionId, this.selectedDates[0], this.selectedDates[1]).then(\r\n          response => {\r\n            this.usersAbsences = response.data;\r\n            this.usersAbsences.forEach(i => i.workerInfo.absences.sort((a1, a2) => new Date(a1.startDate).getTime() - new Date(a2.startDate).getTime()))\r\n          },\r\n          error => {\r\n            this.message =\r\n                (error.response && error.response.data && error.response.data.message) ||\r\n                error.message ||\r\n                error.toString();\r\n          }\r\n      );\r\n    },\r\n    deleteAbsence(userId, absenceId){\r\n      UserService.deleteAbsence(absenceId).then(\r\n          response => {\r\n            response.data;\r\n            let index = this.usersAbsences.find(i => i.id === userId).workerInfo.absences.findIndex(i => i.id === absenceId);\r\n            this.usersAbsences.find(i => i.id === userId).workerInfo.absences.splice(index, 1);\r\n\r\n          },\r\n          error => {\r\n            this.message =\r\n                (error.response && error.response.data && error.response.data.message) ||\r\n                error.message ||\r\n                error.toString();\r\n          }\r\n      )\r\n    }\r\n\r\n  },\r\n  mounted() {\r\n    if (!this.currentUser) {\r\n      this.$router.push('/login');\r\n    }\r\n    UserService.getUser(this.currentUser.id).then(\r\n        response => {\r\n          this.user = response.data;\r\n          this.user.birthday = new Date(response.data.birthday);\r\n        },\r\n        error => {\r\n          this.message =\r\n              (error.response && error.response.data && error.response.data.message) ||\r\n              error.message ||\r\n              error.toString();\r\n        }\r\n    );\r\n    UserService.getPositions().then(\r\n      response => {\r\n        this.positions = response.data;\r\n      },\r\n      error => {\r\n        this.message =\r\n            (error.response && error.response.data && error.response.data.message) ||\r\n            error.message ||\r\n            error.toString();\r\n      }\r\n    );\r\n    this.getAbsences();\r\n  },\r\n  updated(){\r\n    if (this.success){\r\n      this.scrollToAbsence(this.success);\r\n    }\r\n  }\r\n}\r\n</script>"],"sourceRoot":"src/views"}]}