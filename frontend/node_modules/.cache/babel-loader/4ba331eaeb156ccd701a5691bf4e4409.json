{"remainingRequest":"C:\\Вуз\\ТехнРазПО\\Salary\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\Вуз\\ТехнРазПО\\Salary\\frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Вуз\\ТехнРазПО\\Salary\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Вуз\\ТехнРазПО\\Salary\\frontend\\src\\views\\components\\Stat.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Вуз\\ТехнРазПО\\Salary\\frontend\\src\\views\\components\\Stat.vue","mtime":1634772343639},{"path":"C:\\Вуз\\ТехнРазПО\\Salary\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Вуз\\ТехнРазПО\\Salary\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Вуз\\ТехнРазПО\\Salary\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Вуз\\ТехнРазПО\\Salary\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.find-index\";\nimport \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport \"core-js/modules/es6.array.sort\";\nimport \"core-js/modules/es6.array.find\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport UserService from \"../../services/user.service\";\nimport TaskEdit from \"@/views/components/TaskEdit\";\nimport WorkEdit from \"@/views/components/WorkEdit\";\nimport HorizontalScroll from 'vue-horizontal-scroll';\nimport 'vue-horizontal-scroll/dist/vue-horizontal-scroll.css';\nexport default {\n  name: 'Stat',\n  props: ['project'],\n  data: function data() {\n    return {\n      isHidden: true,\n      isWorkHidden: true,\n      content: '',\n      hover: 0,\n      findTask: '',\n      interval_start: '',\n      interval_end: '',\n      works: [],\n      work: {},\n      openParents: [],\n      tasks: [],\n      task: {}\n    };\n  },\n  components: {\n    'v-taskEdit': TaskEdit,\n    'v-workEdit': WorkEdit,\n    'horizontal-scroll': HorizontalScroll\n  },\n  computed: {\n    formatDate: function formatDate() {\n      return function (date) {\n        var formDate = new Date(date);\n        var dd = formDate.getDate();\n        if (dd < 10) dd = '0' + dd;\n        var mm = formDate.getMonth() + 1;\n        if (mm < 10) mm = '0' + mm;\n        var yy = formDate.getFullYear();\n        if (yy < 10) yy = '0' + yy;\n        return yy + '-' + mm + '-' + dd;\n      };\n    },\n    taskWorks: function taskWorks() {\n      var _this = this;\n\n      return function (task) {\n        return _this.works.filter(function (item) {\n          return item.task.id === task.id;\n        }).filter(function (item) {\n          if (!_this.interval_end) return new Date(_this.formatDate(item.workStart)).getTime() === new Date(_this.interval_start ? _this.formatDate(_this.interval_start) : _this.formatDate(new Date())).getTime();else return new Date(_this.formatDate(item.workStart)).getTime() >= new Date(_this.formatDate(_this.interval_start)).getTime() && new Date(_this.formatDate(item.workStart)).getTime() <= new Date(_this.formatDate(_this.interval_end)).getTime();\n        });\n      };\n    },\n    allTaskWords: function allTaskWords() {\n      var _this2 = this;\n\n      return function (task) {\n        return _this2.works.filter(function (item) {\n          return item.task.id === task.id;\n        });\n      }; //yeah, i know that it kinda duplicate\n    },\n    allQuantity: function allQuantity() {\n      var _this3 = this;\n\n      //if it's not broke, don't fix it\n      return function (task) {\n        return _this3.allTaskWords(task).reduce(function (p, v) {\n          return p += (new Date(v.workEnd).getTime() - new Date(v.workStart).getTime()) / 1000 / 60;\n        }, 0);\n      };\n    },\n    getPlans: function getPlans() {\n      var _this4 = this;\n\n      return function (task) {\n        return task.plans.reduce(function (p, v) {\n          return p += task.workerInfos.find(function (item) {\n            return v.user.id == item.id;\n          }) ? v.plan : 0;\n        }.bind(_this4), 0);\n      };\n    },\n    percentageWidth: function percentageWidth() {\n      var _this5 = this;\n\n      return function (task) {\n        return _this5.$refs.taskTable ? _this5.allQuantity(task) / 60 / _this5.getPlans(task) * _this5.$refs.taskTable.clientWidth : 0;\n      };\n    },\n    parents: function parents() {\n      var _this6 = this;\n\n      return this.tasks.filter(function (item) {\n        return !item.parent;\n      }).filter(function (item) {\n        return _this6.taskWorks(item).length > 0 || _this6.children(item).length > 0;\n      }).sort(function (f, s) {\n        return f.task_start > s.task_start ? 1 : -1;\n      }).filter(function (item) {\n        return item.taskName.toLowerCase().includes(_this6.findTask.toLowerCase());\n      }); //can combine filters\n    },\n    children_task: function children_task() {\n      var _this7 = this;\n\n      return this.tasks.filter(function (item) {\n        return item.parent;\n      }).filter(function (item) {\n        return _this7.taskWorks(item).length > 0;\n      }).sort(function (f, s) {\n        return f.task_start > s.task_start ? 1 : -1;\n      });\n    },\n    tableHeight: function tableHeight() {\n      return 50 * (1 + this.parents.length) + this.openParents.reduce(function (p, v) {\n        return v.isOpen && this.parents.find(function (item) {\n          return item.id === v.id;\n        }) ? p += this.children_task.filter(function (item) {\n          return item.parent.id === v.id;\n        }).length : p;\n      }.bind(this), 0) * 30 + 17;\n    },\n    workProps: function workProps() {\n      return function (work) {\n        return {\n          width: (100 / 3600 * (new Date(work.workEnd) - new Date(work.workStart)) / 1000 >= 5 ? 100 / 3600 * (new Date(work.workEnd) - new Date(work.workStart)) / 1000 : 0) + 'px',\n          left: (new Date(work.workStart) - new Date(work.workStart).setHours(0, 0, 0, 0)) / 36 / 1000 + 'px',\n          background: '#6c7bfe',\n          position: 'absolute'\n        };\n      };\n    },\n    quantity: function quantity() {\n      var _this8 = this;\n\n      return function (task) {\n        return _this8.taskWorks(task).reduce(function (p, v) {\n          return p += (new Date(v.workEnd).getTime() - new Date(v.workStart).getTime()) / 1000 / 60;\n        }, 0);\n      };\n    },\n    formateQuantity: function formateQuantity() {\n      return function (quant) {\n        var mm = quant % 60;\n        if (mm < 10) mm = '0' + mm;\n        var hh = quant / 60 >> 0;\n        if (hh < 10) hh = '0' + hh;\n        return (hh + '').slice(0, 2) + ':' + (mm + '').slice(0, 2);\n      };\n    },\n    allTask: function allTask() {\n      var _this9 = this;\n\n      return this.parents.filter(function (item) {\n        return _this9.taskWorks(item).length > 0;\n      }).concat(this.children_task);\n    },\n    currentUser: function currentUser() {\n      return this.$store.state.auth.user;\n    },\n    isUserAdmin: function isUserAdmin() {\n      if (this.currentUser && this.currentUser.roles) {\n        return this.currentUser.roles.includes('ROLE_ADMIN');\n      }\n\n      return false;\n    },\n    isUserManager: function isUserManager() {\n      if (this.currentUser && this.currentUser.roles) {\n        return this.currentUser.roles.includes('ROLE_MANAGER');\n      }\n\n      return false;\n    }\n  },\n  mounted: function mounted() {\n    var _this10 = this;\n\n    this.tasks = this.project.tasks;\n    UserService.getWorksByProject(this.project.id).then(function (response) {\n      // eslint-disable-next-line no-console\n      console.log(response.data);\n      _this10.works = response.data;\n    }, function (error) {\n      _this10.content = error.response && error.response.data && error.response.data.message || error.message || error.toString();\n    });\n\n    if (!this.currentUser) {\n      this.$router.push('/login');\n    }\n  },\n  methods: {\n    open: function open(task) {\n      var parent = this.openParents.find(function (item) {\n        return item.id === task.id;\n      });\n\n      if (parent) {\n        parent.isOpen = !parent.isOpen;\n        this.openParents.splice(this.openParents.findIndex(function (item) {\n          return item.id === parent.id;\n        }), 1, parent);\n      } else {\n        this.openParents.push({\n          id: task.id,\n          isOpen: true\n        });\n      }\n    },\n    children: function children(parent) {\n      // eslint-disable-next-line no-console\n      console.log();\n      return this.children_task.filter(function (item) {\n        return item.parent.id === parent.id;\n      });\n    },\n    children_open: function children_open(parent) {\n      if (this.openParents.find(function (item) {\n        return item.id === parent.id;\n      }) && this.openParents.find(function (item) {\n        return item.id === parent.id;\n      }).isOpen) {\n        return this.children(parent);\n      } else return [];\n    },\n    openWorkEdit: function openWorkEdit(work) {\n      if (work === 0) {\n        this.work = {};\n      } else {\n        this.work = {};\n        Object.assign(this.work, work);\n      }\n\n      this.isWorkHidden = false;\n    },\n    openEdit: function openEdit(task) {\n      if (task === 0) {\n        this.task = {};\n      } else {\n        this.task = {};\n        Object.assign(this.task, task);\n      }\n\n      this.isHidden = false;\n    },\n    post: function post(task) {\n      this.tasks.push(task);\n      Object.assign(this.task, task);\n    },\n    put: function put(task) {\n      this.tasks.splice(this.tasks.findIndex(function (item) {\n        return item.id == task.id;\n      }), 1, task);\n    },\n    del: function del(task) {\n      this.tasks.splice(this.tasks.findIndex(function (item) {\n        return item.id === task.id;\n      }), 1);\n    },\n    workPost: function workPost(work) {\n      this.works.push(work);\n      Object.assign(this.work, work);\n    },\n    workPut: function workPut(work) {\n      this.works.splice(this.works.findIndex(function (item) {\n        return item.id == work.id;\n      }), 1, work);\n    },\n    workDel: function workDel(work) {\n      this.works.splice(this.works.findIndex(function (item) {\n        return item.id === work.id;\n      }), 1);\n    },\n    test: function test() {}\n  }\n};",{"version":3,"sources":["Stat.vue"],"names":[],"mappings":"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","sourcesContent":["<style scoped>\nh3{\n  margin: 0 20px 0 0;\n}\n</style>\n<template>\n  <div>\n    <v-taskEdit v-if='!isHidden' v-on:hide=\"isHidden = true\"\n                :task=\"task\" :post=\"post\" :put=\"put\" :del=\"del\" :option=\"'view'\"></v-taskEdit>\n    <v-workEdit v-if='!isWorkHidden' v-on:whide=\"isWorkHidden = true\"\n                :work=\"work\" :post=\"workPost\" :put=\"workPut\" :del=\"workDel\" :option=\"'project'\"></v-workEdit>\n\n    <div>\n      <div class=\"column\">\n        <div class=\"row\" style=\"margin-bottom: 0\" v-if=\"false\"> <!--not needed yet-->\n          <input type=\"checkbox\" checked v-model=\"completed\"><h3>Выполненные</h3>\n          <input type=\"checkbox\" checked v-model=\"overdue\"><h3>Просроченные</h3>\n          <input type=\"checkbox\" checked v-model=\"inWork\"><h3>В работе</h3>\n        </div>\n        <div class=\"row\">\n          <h3 style=\"margin-right: 10px\">{{ interval_start ? 'Показать с:' : 'Показать за' }} </h3>\n          <input class=\"date\" type=\"date\" v-model=\"interval_start\" min=\"2015-01-01\" max=\"2030-01-01\"/>\n          <h3 v-if=\"interval_start\" style=\"margin-right: 10px\">до: </h3>\n          <input v-if=\"interval_start\" class=\"date\" type=\"date\" v-model=\"interval_end\" min=\"2015-01-01\" max=\"2030-01-01\"/>\n          <div class=\"button-g\" @click=\"interval_start=interval_end=''\">Сбросить</div>\n        </div>\n      </div>\n      <div v-if=\"interval_end\">\n        <div class=\"row\" v-for=\"task in allTask\" :key=\"task.id\">\n          <div class=\"task\" style=\"cursor: auto\" >{{task.taskName}} - {{formateQuantity(quantity(task))}}</div>\n        </div>\n      </div>\n      <!--   WATERFALL-->\n      <div v-else class=\"row tasks\" ref=\"tasks\" style=\"align-items: flex-start\">\n        <div class=\"task-table\" ref=\"taskTable\">\n          <div class=\"row-in-table\"><div class=\"task-in-table\"><h3>Поиск: </h3>\n            <input type=\"text\" maxlength=\"30\" v-autowidth=\"{maxWidth: '200px', minWidth: '100px', comfortZone: 0}\" v-model=\"findTask\" style=\"font-size:16px\"/></div>\n          </div>\n          <div class=\"row-in-table\" v-for=\"task in parents\" :key=\"task.id\">\n            <div style=\"display: flex; justify-content: space-between; align-items: center;\"\n                 v-bind:class=\"[hover === task.id ? 'hover' : '']\" @mouseover='hover = task.id' @mouseout=\"hover = 0\">\n              <div class=\"column\" style=\"width: 100%\">\n                <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n\n                  <div class=\"arrow-btn\" v-bind:class=\"[children(task).length === 0 ? 'hidden' : '','arrow-btn']\"\n                       v-bind:style=\"{transform: children_open(task).length === 0 ? 'rotate(0.0turn)' : 'rotate(0.25turn)'}\"\n                       @click=\"open(task)\"></div>\n\n                  <div class=\"task-in-table\" @click=\"openEdit(task)\">\n                    <div>\n                      {{ task.taskName }} - {{formateQuantity(quantity(task))}}\n                    </div>\n                  </div>\n\n                  <div class=\"plus-btn\" @click=\"openWorkEdit({task: task})\" data-content=\"Добавить время работы\"></div>\n\n                </div>\n                <div v-if=\"getPlans(task)>0\" class=\"pop-up\" style=\"top: 45px\" v-bind:data-content=\"Number(allQuantity(task)/60).toFixed(2) + ' из ' + getPlans(task) + (getPlans(task)%10 == 1 ? ' часа':' часов')\">\n                  <div class=\"progress\">\n                    <div class=\"percentage\" v-bind:style=\"{width: percentageWidth(task)+'px'}\"></div>\n                  </div>\n                </div>\n              </div>\n\n\n            </div>\n            <div v-for=\"child_task in children_open(task) \" :key=\"child_task.id\" style=\"display: flex; align-items: center\"\n                 v-bind:class=\"[hover === child_task.id ? 'hover' : '']\" @mouseover='hover = child_task.id' @mouseout=\"hover = 0\">\n              <div class=\"column\" style=\"width: 100%\">\n                <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                  <div class=\"task-in-table subtask-in-table\"\n                       @click=\"openEdit(child_task)\">\n                    {{child_task.taskName}} - {{formateQuantity(quantity(child_task))}}\n                  </div>\n                  <div class=\"plus-btn\" @click=\"openWorkEdit({task: child_task})\" data-content=\"Добавить время работы\"></div>\n                </div>\n                <div v-if=\"getPlans(child_task)>0\" class=\"pop-up\" style=\"bottom: 0\" v-bind:data-content=\"Number(allQuantity(child_task)/60).toFixed(2) + ' из ' + getPlans(child_task) + (getPlans(child_task)%10 == 1 ? ' часа':' часов')\">\n                  <div class=\"progress\">\n                    <div class=\"percentage\" v-bind:style=\"{width: percentageWidth(child_task)+'px'}\"></div>\n                  </div>\n                </div>\n              </div>\n\n            </div>\n\n          </div>\n\n        </div>\n        <horizontal-scroll class=\"horizontal-scroll\" ref=\"table\" v-bind:style=\"{height: tableHeight + 'px'}\">\n          <div class=\"table\" v-bind:style=\"{width: 100*24 + 'px'}\">\n            <!--dates row-->\n            <div class=\"main-table-row\"><div class=\"table-row\">\n              <div class=\"dates\" v-for=\"date in Array.from({length: 24}, (v, k) => k)\" :key=\"date\" style=\"width: 100px; flex-direction: row;\">\n                <div style=\"padding-left: 5px\"> {{date &lt; 10 ? '0' + date : date}}:00 </div>\n              </div>\n            </div></div>\n            <!--content rows-->\n            <div class=\"main-table-row\" v-for=\"task in parents\" :key=\"task.id\">\n              <div class=\"table-row\" v-bind:class=\"[hover === task.id ? 'hover' : '']\" @mouseover='hover = task.id' @mouseout=\"hover = 0\">\n                <div class=\"table-task\" style=\"height: 20px; padding: 5px 0\"\n                     v-for=\"work in taskWorks(task)\" :key=\"work.id\"\n                     v-bind:style=\"workProps(work)\" @click=\"openWorkEdit(work)\"></div>\n              </div>\n              <div class=\"table-row table-subrow\" style=\"height: 20px; padding: 5px 0\"\n                   v-for=\"child_task in children_open(task) \" :key=\"child_task.id\"\n                   v-bind:class=\"[hover === child_task.id ? 'hover' : '']\" @mouseover='hover = child_task.id' @mouseout=\"hover = 0\">\n                <div class=\"table-task\" style=\"height: 20px\"\n                     v-for=\"child_work in taskWorks(child_task)\" :key=\"child_work.id\"\n                     v-bind:style=\"workProps(child_work)\" @click=\"openWorkEdit(child_work)\"></div>\n              </div>\n            </div>\n          </div>\n        </horizontal-scroll>\n      </div>\n    </div>\n\n  </div>\n</template>\n\n<script>\nimport UserService from '../../services/user.service';\nimport TaskEdit from \"@/views/components/TaskEdit\";\nimport WorkEdit from \"@/views/components/WorkEdit\";\nimport HorizontalScroll from 'vue-horizontal-scroll'\nimport 'vue-horizontal-scroll/dist/vue-horizontal-scroll.css'\n\nexport default {\n  name: 'Stat',\n  props: ['project'],\n  data() {\n    return {\n      isHidden: true,\n      isWorkHidden: true,\n      content: '',\n      hover: 0,\n\n      findTask: '',\n      interval_start: '',\n      interval_end: '',\n\n      works: [],\n      work: {},\n\n      openParents: [],\n      tasks: [],\n      task: {}\n    };\n  },\n  components:{\n    'v-taskEdit' : TaskEdit,\n    'v-workEdit' : WorkEdit,\n    'horizontal-scroll' : HorizontalScroll\n  },\n  computed: {\n    formatDate() {\n      return date => {\n        let formDate = new Date(date);\n        let dd = formDate.getDate();\n        if (dd < 10) dd = '0' + dd;\n        let mm = formDate.getMonth() + 1;\n        if (mm < 10) mm = '0' + mm;\n        let yy = formDate.getFullYear();\n        if (yy < 10) yy = '0' + yy;\n        return  yy + '-' + mm + '-' + dd;\n      }\n    },\n    taskWorks(){\n      return task => this.works\n          .filter(item => item.task.id === task.id)\n          .filter(item => {\n            if (!this.interval_end) return (new Date(this.formatDate(item.workStart)).getTime() === new Date(this.interval_start ? this.formatDate(this.interval_start): this.formatDate(new Date())).getTime());\n            else return (new Date(this.formatDate(item.workStart)).getTime() >= new Date(this.formatDate(this.interval_start)).getTime() && new Date(this.formatDate(item.workStart)).getTime() <= new Date(this.formatDate(this.interval_end)).getTime());\n          })\n\n    },\n    allTaskWords(){\n      return task => this.works\n          .filter(item => item.task.id === task.id)    //yeah, i know that it kinda duplicate\n    },\n    allQuantity(){ //if it's not broke, don't fix it\n      return task => this.allTaskWords(task).reduce(function (p, v) {\n        return ( p += (new Date(v.workEnd).getTime() - new Date(v.workStart).getTime())/1000/60 );\n      }, 0);\n    },\n    getPlans(){\n      return task => task.plans.reduce(function (p, v) {\n        return p+= task.workerInfos.find(item => v.user.id == item.id) ? v.plan : 0;\n      }.bind(this), 0);\n    },\n    percentageWidth(){\n      return task => {\n        return this.$refs.taskTable ? this.allQuantity(task)/60/this.getPlans(task)*this.$refs.taskTable.clientWidth : 0;\n      }\n    },\n    parents(){\n      return this.tasks.filter(item => (!item.parent))\n          .filter(item =>(this.taskWorks(item).length>0 || this.children(item).length > 0))\n          .sort(function(f, s) {return f.task_start > s.task_start ? 1 : -1})\n          .filter(item=>item.taskName.toLowerCase().includes(this.findTask.toLowerCase()));\n      //can combine filters\n    },\n    children_task(){\n      return this.tasks.filter(item => (item.parent))\n          .filter(item =>(this.taskWorks(item).length>0))\n          .sort(function(f, s) {return f.task_start > s.task_start ? 1 : -1});\n    },\n    tableHeight(){\n      return  50*(1+this.parents.length)+ this.openParents.reduce(function (p, v) {\n        return ( v.isOpen && this.parents.find(item => item.id === v.id) ? p+=(this.children_task.filter(item => (item.parent.id === v.id)).length) : p );\n      }.bind(this), 0)*30+17;\n    },\n\n    workProps(){\n      return work => ({\n        width: ((100/3600*(new Date(work.workEnd) - new Date(work.workStart))/1000) >= 5 ? (100/3600*(new Date(work.workEnd) - new Date(work.workStart))/1000) : 0) + 'px',\n        left: (new Date(work.workStart) - new Date (work.workStart).setHours(0,0,0,0))/36/1000 + 'px',\n        background: '#6c7bfe',\n        position: 'absolute'\n      });\n    },\n\n    quantity(){\n      return task => this.taskWorks(task).reduce(function (p, v) {\n        return ( p += (new Date(v.workEnd).getTime() - new Date(v.workStart).getTime())/1000/60 );\n      }, 0);\n    },\n    formateQuantity(){\n      return quant => {\n        let mm = quant%60;\n        if (mm < 10) mm = '0' + mm;\n        let hh = quant/60>>0;\n        if (hh < 10) hh = '0' + hh;\n        return  (hh+'').slice(0,2) + ':' + (mm+'').slice(0,2);\n      }\n    },\n    allTask(){\n      return this.parents.filter(item =>(this.taskWorks(item).length>0)).concat(this.children_task);\n    },\n    currentUser() {\n      return this.$store.state.auth.user;\n    },\n    isUserAdmin() {\n      if (this.currentUser && this.currentUser.roles) {\n        return this.currentUser.roles.includes('ROLE_ADMIN');\n      }\n\n      return false;\n    },\n    isUserManager() {\n      if (this.currentUser && this.currentUser.roles) {\n        return this.currentUser.roles.includes('ROLE_MANAGER');\n      }\n\n      return false;\n    }\n  },\n  mounted() {\n    this.tasks = this.project.tasks;\n    UserService.getWorksByProject(this.project.id).then(\n        response => {\n          // eslint-disable-next-line no-console\n          console.log(response.data)\n          this.works = response.data;\n        },\n        error => {\n          this.content =\n              (error.response && error.response.data && error.response.data.message) ||\n              error.message ||\n              error.toString();\n        }\n    );\n    if (!this.currentUser) {\n      this.$router.push('/login');\n    }\n  },\n  methods: {\n    open(task){\n      let parent = this.openParents.find(item => item.id === task.id);\n      if (parent) {\n        parent.isOpen = !parent.isOpen;\n        this.openParents.splice(this.openParents.findIndex(item => item.id === parent.id), 1, parent);\n      } else {\n        this.openParents.push({id: task.id, isOpen: true})\n      }\n\n    },\n    children(parent){\n      // eslint-disable-next-line no-console\n      console.log();\n\n\n\n      return this.children_task.filter(item => (item.parent.id === parent.id))\n    },\n    children_open(parent){\n      if (this.openParents.find(item => item.id === parent.id) &&\n          this.openParents.find(item => item.id === parent.id).isOpen){\n        return this.children(parent);\n      }\n      else return [];\n    },\n    openWorkEdit(work){\n      if (work === 0) {this.work = {}}\n      else {\n        this.work = {}\n        Object.assign(this.work, work);\n      }\n      this.isWorkHidden = false;\n    },\n    openEdit(task){\n      if (task === 0) {this.task = {}}\n      else {\n        this.task = {}\n        Object.assign(this.task, task);\n      }\n      this.isHidden = false;\n\n    },\n    post(task){\n      this.tasks.push(task);\n      Object.assign(this.task, task);\n    },\n    put(task){\n      this.tasks.splice(this.tasks.findIndex(item => item.id == task.id), 1, task);\n\n    },\n    del(task){\n      this.tasks.splice(this.tasks.findIndex(item => item.id === task.id),1);\n    },\n    workPost(work){\n      this.works.push(work);\n      Object.assign(this.work, work);\n    },\n    workPut(work){\n      this.works.splice(this.works.findIndex(item => item.id == work.id), 1, work);\n\n    },\n    workDel(work){\n      this.works.splice(this.works.findIndex(item => item.id === work.id),1);\n    },\n    test(){\n\n    }\n  }\n};\n</script>"],"sourceRoot":"src/views/components"}]}