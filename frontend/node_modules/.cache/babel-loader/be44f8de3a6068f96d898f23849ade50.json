{"remainingRequest":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\University\\SoftDevTech\\Salary\\frontend\\src\\views\\components\\absenceEditor.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\src\\views\\components\\absenceEditor.vue","mtime":1637971833262},{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es6.array.find\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport DatePicker from 'vue2-datepicker';\nimport 'vue2-datepicker/index.css';\nimport 'vue2-datepicker/locale/es/ru.js';\nimport UserService from \"@/services/user.service\";\nexport default {\n  name: \"absenceEditor\",\n  props: ['absence', 'userToEdit', 'success', 'close', 'isUserAccountant'],\n  data: function data() {\n    return {\n      message: '',\n      selectedDates: [],\n      selectedWorker: '',\n      selectedWorkerId: '',\n      workerFocus: false,\n      workers: [],\n      user: {},\n      lang: {\n        formatLocale: {\n          months: ['января', 'февраля', 'марта', 'апреля', 'мая', 'июня', 'июля', 'августа', 'сентября', 'октября', 'ноября', 'декабря']\n        }\n      }\n    };\n  },\n  components: {\n    DatePicker: DatePicker\n  },\n  computed: {\n    isCreate: function isCreate() {\n      return !(this.absence && this.absence.id);\n    },\n    currentUser: function currentUser() {\n      return this.$store.state.auth.user;\n    }\n  },\n  methods: {\n    deactivateWorkerFocus: function deactivateWorkerFocus() {\n      this.selectedWorker = this.workers.length && this.selectedWorker ? this.workers[0].lastName + ' ' + this.workers[0].firstName + ' ' + this.workers[0].patronymic : this.user.id ? this.user.lastName + ' ' + this.user.firstName + ' ' + this.user.patronymic : '';\n      this.selectedWorkerId = this.workers.length && this.selectedWorker ? this.workers[0].id : this.user ? this.user.id : '';\n      this.workerFocus = false;\n    },\n    changeUser: function changeUser() {\n      var _this = this;\n\n      if (!this.user.id) {\n        this.workers.find(function (i) {\n          return i.id === _this.selectedWorkerId;\n        }).workerInfo.absences = [this.absence];\n        this.user = this.isUserAccountant ? this.workers.find(function (i) {\n          return i.id === _this.selectedWorkerId;\n        }) : this.currentUser;\n      } else {\n        this.user.workerInfo.absences = [this.absence];\n      } //you need validate form first\n      //set id after save new one and change method to edit OR close window\n      //show message after successful post/put\n      //also you forgot about update list when you add new absence of edit existing\n\n\n      UserService.changeUser(this.user.id, this.user).then(function (response) {\n        _this.success(response.data.id, response.data.workerInfo.absences.find(function (i) {\n          return new Date(i.startDate).getTime() === new Date(_this.absence.startDate).getTime();\n        }));\n      }, function (error) {\n        _this.message = error.response && error.response.data && error.response.data.message || error.message || error.toString();\n      });\n    },\n    getUsersByName: function getUsersByName() {\n      var _this2 = this;\n\n      UserService.getUsersByName(this.selectedWorker).then(function (response) {\n        _this2.workers = response.data.filter(function (i) {\n          return i.workerInfo;\n        });\n      }, function (error) {\n        _this2.message = error.response && error.response.data && error.response.data.message || error.message || error.toString();\n      });\n    }\n  },\n  mounted: function mounted() {\n    var _this3 = this;\n\n    if (this.userToEdit || !this.isUserAccountant) {\n      UserService.getUser(this.userToEdit ? this.userToEdit : this.currentUser.id).then(function (response) {\n        _this3.user = response.data;\n\n        if (_this3.absence.id) {\n          _this3.selectedDates = [new Date(_this3.absence.startDate), new Date(_this3.absence.endDate)];\n          _this3.selectedWorker = _this3.user.lastName + ' ' + _this3.user.firstName + ' ' + _this3.user.patronymic;\n          _this3.selectedWorkerId = _this3.user.id;\n        }\n      }, function (error) {\n        _this3.message = error.response && error.response.data && error.response.data.message || error.message || error.toString();\n      });\n    }\n  }\n};",{"version":3,"sources":["absenceEditor.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"cover\" @click=\"close()\"></div>\r\n\r\n    <div class=\"absence-editor\">\r\n      <div>\r\n        {{isCreate ? 'Добавить' : 'Изменить'}} информацию о пропуске\r\n        <span class=\"material-icons close-icon\" @click=\"close()\">close</span>\r\n      </div>\r\n\r\n      <div class=\"row\">\r\n        <div class=\"column\">\r\n          <div class=\"row user-info\">Период пропуска:</div>\r\n          <div v-if=\"isUserAccountant\" class=\"row user-info\">Сотрудник:</div>\r\n        </div>\r\n        <div class=\"column\">\r\n          <div class=\"row\" style=\"margin: 8px 0\">\r\n            <date-picker v-model=\"selectedDates\"\r\n                         @change=\"absence.startDate = selectedDates[0];\r\n                                    absence.endDate = selectedDates[1];\"\r\n                         style=\"outline: 0;\r\n                              width: 280px;\r\n                              border: 1px solid #dce1e6;\r\n                              border-radius: 3px;\r\n                              padding: 6px 12px;\"\r\n                         type=\"date\"\r\n                         :range=true\r\n                         range-separator = \" - \"\r\n                         format=\"DD MMMM YYYY\"\r\n                         :lang=\"lang\"\r\n                         :clearable = \"false\"\r\n                         input-class=\"date-picker kludge\"\r\n                         placeholder=\"Выбрать\">\r\n            </date-picker>\r\n          </div>\r\n          <div v-if=\"isUserAccountant\" class=\"row\" v-click-outside=\"deactivateWorkerFocus\" style=\"margin: 8px 0; position: relative\">\r\n            <div style=\"position: relative; width: 100%\">\r\n              <input v-on:focus=\"workerFocus = true\" type=\"text\" class=\"border-input\" style=\"width: 100%\" v-model=\"selectedWorker\" @input=\"getUsersByName()\">\r\n              <span class=\"material-icons close-icon\" @click=\"selectedWorker=''; selectedWorkerId='';\" style=\"position: absolute; top:calc(50% - 10px); right:18px;\">close</span>\r\n            </div>\r\n\r\n            <div v-if=\"selectedWorker && workerFocus && workers.length\" class=\"input-select\">\r\n              <div v-for=\"worker in workers\" :key=\"worker.id\" @click=\"selectedWorker=worker.firstName+worker.lastName+worker.patronymic; selectedWorkerId=worker.id; workerFocus=false;\">\r\n                {{worker.lastName}} {{worker.firstName}} {{worker.patronymic}}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n        </div>\r\n      </div>\r\n      <div class=\"row\" style=\"align-items: flex-start\">\r\n        <div class=\"column\">\r\n          <div class=\"row user-info\" style=\"margin: 0\">Причина:</div>\r\n        </div>\r\n        <div class=\"column\" style=\"width: 100%\">\r\n          <textarea v-model=\"absence.reason\" class=\"border-input\"></textarea>\r\n        </div>\r\n      </div>\r\n      <div>\r\n        <div class=\"btn btn-thin\" @click=\"changeUser()\" style=\"margin: 0\">{{isCreate ? 'Добавить' : 'Изменить'}}</div> {{message}}\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n\r\nimport DatePicker from 'vue2-datepicker';\r\nimport 'vue2-datepicker/index.css';\r\nimport 'vue2-datepicker/locale/es/ru.js';\r\nimport UserService from \"@/services/user.service\";\r\n\r\nexport default {\r\n  name: \"absenceEditor\",\r\n  props: ['absence', 'userToEdit', 'success', 'close', 'isUserAccountant'],\r\n  data() {\r\n    return {\r\n      message: '',\r\n\r\n      selectedDates: [],\r\n\r\n      selectedWorker: '',\r\n      selectedWorkerId: '',\r\n      workerFocus: false,\r\n      workers:[],\r\n\r\n      user:{},\r\n\r\n      lang: {\r\n        formatLocale: {\r\n          months: ['января', 'февраля', 'марта', 'апреля', 'мая', 'июня', 'июля', 'августа', 'сентября', 'октября', 'ноября', 'декабря'],\r\n        }\r\n      }\r\n    };\r\n  },\r\n  components:{\r\n    DatePicker\r\n  },\r\n  computed:{\r\n    isCreate(){\r\n      return !(this.absence && this.absence.id)\r\n    },\r\n    currentUser() {\r\n      return this.$store.state.auth.user;\r\n    }\r\n  },\r\n  methods:{\r\n    deactivateWorkerFocus(){\r\n      this.selectedWorker =\r\n          this.workers.length && this.selectedWorker ? this.workers[0].lastName + ' ' + this.workers[0].firstName + ' ' + this.workers[0].patronymic\r\n          : (this.user.id ? this.user.lastName + ' ' + this.user.firstName + ' ' + this.user.patronymic : '');\r\n      this.selectedWorkerId = this.workers.length && this.selectedWorker ? this.workers[0].id : (this.user ? this.user.id : '');\r\n      this.workerFocus = false;\r\n    },\r\n    changeUser(){\r\n\r\n      if (!this.user.id){\r\n        this.workers.find(i => i.id === this.selectedWorkerId).workerInfo.absences = [this.absence];\r\n        this.user = this.isUserAccountant ? this.workers.find(i => i.id === this.selectedWorkerId) : this.currentUser;\r\n      } else {\r\n        this.user.workerInfo.absences  = [this.absence];\r\n      }\r\n\r\n\r\n      //you need validate form first\r\n      //set id after save new one and change method to edit OR close window\r\n      //show message after successful post/put\r\n      //also you forgot about update list when you add new absence of edit existing\r\n      UserService.changeUser(this.user.id, this.user).then(\r\n          response => {\r\n\r\n            this.success(response.data.id, response.data.workerInfo.absences.find(i => new Date(i.startDate).getTime() === new Date(this.absence.startDate).getTime()));\r\n          },\r\n          error => {\r\n            this.message =\r\n                (error.response && error.response.data && error.response.data.message) ||\r\n                error.message ||\r\n                error.toString();\r\n          }\r\n      );\r\n    },\r\n    getUsersByName(){\r\n      UserService.getUsersByName(this.selectedWorker).then(\r\n          response => {\r\n            this.workers = response.data.filter(i => i.workerInfo);\r\n          },\r\n          error => {\r\n            this.message =\r\n                (error.response && error.response.data && error.response.data.message) ||\r\n                error.message ||\r\n                error.toString();\r\n          }\r\n      );\r\n    }\r\n  },\r\n  mounted() {\r\n\r\n    if (this.userToEdit || !this.isUserAccountant){\r\n      UserService.getUser(this.userToEdit ? this.userToEdit : this.currentUser.id).then(\r\n          response => {\r\n            this.user = response.data;\r\n            if (this.absence.id){\r\n              this.selectedDates = [new Date(this.absence.startDate),new Date(this.absence.endDate)];\r\n              this.selectedWorker = this.user.lastName + ' ' + this.user.firstName + ' ' + this.user.patronymic;\r\n              this.selectedWorkerId = this.user.id;\r\n            }\r\n          },\r\n          error => {\r\n            this.message =\r\n                (error.response && error.response.data && error.response.data.message) ||\r\n                error.message ||\r\n                error.toString();\r\n          }\r\n      )\r\n    }\r\n\r\n\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>"],"sourceRoot":"src/views/components"}]}