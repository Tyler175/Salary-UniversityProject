{"remainingRequest":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\University\\SoftDevTech\\Salary\\frontend\\src\\views\\Salary.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\src\\views\\Salary.vue","mtime":1638195085755},{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport Menu from \"@/views/components/Menu\";\r\nimport Header from \"@/views/components/Header\";\r\nimport UserService from \"@/services/user.service\";\r\nimport message from \"@/views/components/message\";\r\n\r\nimport DatePicker from 'vue2-datepicker';\r\nimport 'vue2-datepicker/index.css';\r\nimport 'vue2-datepicker/locale/es/ru.js';\r\n\r\n\r\nexport default {\r\n  name: \"Salary\",\r\n  data(){\r\n\r\n    return{\r\n      message: '',\r\n\r\n      showMessage: false,\r\n\r\n      sortKey: \"\",\r\n      sortOrders: {},\r\n      searchQuery: \"\",\r\n      gridColumns: [\"name\", \"position\", \"absenceDays\", \"salary\", \"award\", \"result\"],\r\n      gridLocaleColumns: [\"ФИО\", \"Должность\", \"Пропуски\", \"Зарплата\", \"Премия\", \"Итого\"],\r\n\r\n      gridData: [],\r\n      gridData1: [\r\n        { name: \"Chuck Norris\", power: Infinity },\r\n        { name: \"Bruce Lee\", power: 9000 },\r\n        { name: \"Jackie Chan\", power: 7000 },\r\n        { name: \"Jet Li\", power: 8000 }\r\n      ],\r\n\r\n      selectedDate: new Date(new Date()),\r\n\r\n      premiumBudget: 0,\r\n\r\n      users: [],\r\n\r\n      user:{\r\n        firstName: '',\r\n        profilePicture: '',\r\n        gender: false\r\n      },\r\n\r\n      lang: {\r\n        formatLocale: {\r\n          months: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'],\r\n        }\r\n      }\r\n    };\r\n  },\r\n  components:{\r\n    DatePicker,\r\n    'v-menu' : Menu,\r\n    'v-header': Header,\r\n    'v-message': message\r\n  },\r\n  computed: {\r\n    remainPremiumBudget(){\r\n      let res = this.premiumBudget\r\n      this.gridData.forEach(i => res-=i.award.amount);\r\n      return res;\r\n    },\r\n\r\n    filteredHeroes: function() {\r\n      var sortKey = this.sortKey;\r\n      var filterKey = this.searchQuery && this.searchQuery.toLowerCase();\r\n      var order = this.sortOrders[sortKey] || 1;\r\n      var heroes = this.gridData;\r\n      if (filterKey) {\r\n        heroes = heroes.filter(function(row) {\r\n          return Object.keys(row).some(function(key) {\r\n            return (\r\n                String(row[key])\r\n                    .toLowerCase()\r\n                    .indexOf(filterKey) > -1\r\n            );\r\n          });\r\n        });\r\n      }\r\n      if (sortKey) {\r\n        heroes = heroes.slice().sort(function(a, b) {\r\n          a = a[sortKey];\r\n          b = b[sortKey];\r\n          return (a === b ? 0 : a > b ? 1 : -1) * order;\r\n        });\r\n      }\r\n      return heroes;\r\n    },\r\n\r\n    currentUser() {\r\n      return this.$store.state.auth.user;\r\n    },\r\n    isUserAdmin() {\r\n      if (this.currentUser && this.currentUser.roles) {\r\n        return this.currentUser.roles.includes('ROLE_ADMIN');\r\n      }\r\n\r\n      return false;\r\n    },\r\n    isUserAccountant() {\r\n      if (this.currentUser && this.currentUser.roles) {\r\n        return this.currentUser.roles.includes('ROLE_ACCOUNTANT');\r\n      }\r\n\r\n      return false;\r\n    }\r\n  },\r\n  filters: {\r\n    capitalize: function(str) {\r\n      return str.charAt(0).toUpperCase() + str.slice(1);\r\n    }\r\n  },\r\n  methods: {\r\n    close(){\r\n      this.showMessage = false;\r\n      this.message = ''\r\n    },\r\n    changeSalary(user){\r\n      if (this.remainPremiumBudget < 0){\r\n        user.award.amount = 0;\r\n        this.message = \"Вы вышли за пределы премиального бюджета\"\r\n        this.showMessage = true;\r\n      }\r\n      user.result = ((parseFloat(user.salary) + parseFloat(user.award.amount))*0.87).toFixed(2);\r\n      user.award.month = this.selectedDate;\r\n      UserService.changeAwards(user).then(\r\n          response => {\r\n            user.award = response.data;\r\n          },\r\n          error=>{\r\n            this.message =\r\n                (error.response && error.response.data && error.response.data.message) ||\r\n                error.message ||\r\n                error.toString();\r\n          }\r\n      )\r\n\r\n    },\r\n    isFloat(n){\r\n      return Number(n) === n && n % 1 !== 0;\r\n    },\r\n    sortBy: function(index) {\r\n      let key = this.gridColumns[index];\r\n      this.sortKey = key;\r\n      this.sortOrders[key] = this.sortOrders[key] * -1;\r\n    },\r\n    changeUser(){\r\n      UserService.changeUser(this.currentUser.id, this.user).then(\r\n          response => {\r\n            response.data;\r\n          },\r\n          error => {\r\n            this.message =\r\n                (error.response && error.response.data && error.response.data.message) ||\r\n                error.message ||\r\n                error.toString();\r\n          }\r\n      );\r\n    },\r\n\r\n\r\n    getSalary(){\r\n      UserService.getSalary(this.selectedDate).then(\r\n          response => {\r\n            this.gridData = this.isUserAccountant ? response.data : response.data.filter(i => i.id === this.currentUser.id);\r\n\r\n            this.gridData.forEach(i => i.result = (i.salary + i.award.amount)*0.87)\r\n          },\r\n          error => {\r\n            this.message =\r\n                (error.response && error.response.data && error.response.data.message) ||\r\n                error.message ||\r\n                error.toString();\r\n          }\r\n      );\r\n      UserService.getBudget(this.selectedDate).then(\r\n          response => {\r\n            this.premiumBudget = response.data.amount;\r\n          },\r\n          error => {\r\n            this.message =\r\n                (error.response && error.response.data && error.response.data.message) ||\r\n                error.message ||\r\n                error.toString();\r\n          }\r\n      );\r\n    }\r\n  },\r\n  mounted() {\r\n    if (!this.currentUser) {\r\n      this.$router.push('/login');\r\n    }\r\n\r\n    let sortOrders = {};\r\n    this.gridColumns.forEach(function(key) {\r\n      sortOrders[key] = 1;\r\n    });\r\n    this.sortOrders = sortOrders;\r\n\r\n    UserService.getUser(this.currentUser.id).then(\r\n        response => {\r\n          this.user = response.data;\r\n          this.user.birthday = new Date(response.data.birthday);\r\n        },\r\n        error => {\r\n          this.message =\r\n              (error.response && error.response.data && error.response.data.message) ||\r\n              error.message ||\r\n              error.toString();\r\n        }\r\n    );\r\n    this.getSalary();\r\n  }\r\n}\r\n",{"version":3,"sources":["Salary.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqGA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Salary.vue","sourceRoot":"src/views","sourcesContent":["<style scoped>\r\n  .mx-datepicker{\r\n    width: fit-content;\r\n  }\r\n  input:disabled{\r\n    background: none;\r\n  }\r\n</style>\r\n<template>\r\n  <div v-if=\"currentUser\">\r\n    <v-header\r\n        v-bind:user=\"{\r\n        firstName: user.firstName,\r\n        profilePicture: user.profilePicture,\r\n        gender: user.gender\r\n      }\">\r\n    </v-header>\r\n\r\n    <v-message v-if=\"showMessage\" :message=\"message\" :close=\"close\"></v-message>\r\n\r\n    <div class=\"container\">\r\n      <v-menu></v-menu>\r\n\r\n      <div class=\"content\" style=\"width: calc(80% - 15% - 285px + 245px)\">\r\n        <h1 class=\"h1\">Распределение зарплат</h1>\r\n        <div class=\"separator\"></div>\r\n        <div class=\"row\" style=\"align-items: flex-start;\">\r\n\r\n          <div class=\"row user-info\">Месяц:</div>\r\n          <div class=\"row\" style=\"margin: 8px 0\">\r\n            <date-picker v-model=\"selectedDate\"\r\n                         @change=\"getSalary\"\r\n                         style=\"outline: 0;\r\n                              width: 200px;\r\n                              border: 1px solid #dce1e6;\r\n                              border-radius: 3px;\r\n                              padding: 6px 12px;\"\r\n                         type=\"month\"\r\n                         format=\"MMMM YYYY\"\r\n                         :lang=\"lang\"\r\n                         :clearable = \"false\"\r\n                         input-class=\"date-picker\"\r\n                         placeholder=\"Выбрать\">\r\n            </date-picker>\r\n          </div>\r\n          <div v-if=\"isUserAccountant\" class=\"column\" style=\"margin-left: 50px\">\r\n            <div class=\"row\">\r\n              <div class=\"user-info\">Премиальный бюджет:</div> <span>{{premiumBudget}}</span>\r\n            </div>\r\n            <div class=\"row\">\r\n              <div class=\"user-info\">Остаток:</div> <span>{{remainPremiumBudget}}</span>\r\n            </div>\r\n\r\n\r\n          </div>\r\n          <div v-else class=\"column\" style=\"margin-left: 50px\">\r\n            <div class=\"row\">\r\n              <div class=\"user-info\">Плановые дни:</div> <span>21</span>\r\n            </div>\r\n            <div class=\"row\">\r\n              <div class=\"user-info\">Фактические дни:</div> <span>17</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"separator\"></div>\r\n\r\n        <table class=\"table\">\r\n          <thead class=\"thead\">\r\n          <tr class=\"tr\">\r\n            <th class=\"th\" v-for=\"(key, index) in gridLocaleColumns\"\r\n                :key=\"index\"\r\n                @click=\"sortBy(index)\"\r\n                :class=\"{ active: sortKey == gridColumns[index] }\">\r\n              {{ key | capitalize }}\r\n              <span class=\"arrow\" :class=\"sortOrders[gridColumns[index]] > 0 ? 'asc' : 'dsc'\">\r\n              </span>\r\n            </th>\r\n          </tr>\r\n          </thead>\r\n          <tbody class=\"tbody\">\r\n          <tr class=\"tr\" v-for=\"(entry, entryIndex) in filteredHeroes\"\r\n            :key = \"entryIndex\">\r\n            <td class=\"td\" v-for=\"(key, index) in gridColumns\" :key = \"index\">\r\n              <div v-if=\"key!=='award'\">{{isFloat(entry[key]) ? (entry[key]).toFixed(2) : (entry[key])}}</div>\r\n              <input v-else :disabled=\"!isUserAccountant\" class=\"table-input\" type=\"number\" v-model=\"entry[key].amount\" @input=\"changeSalary(entry)\">\r\n            </td>\r\n          </tr>\r\n          </tbody>\r\n        </table>\r\n\r\n\r\n\r\n\r\n\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Menu from \"@/views/components/Menu\";\r\nimport Header from \"@/views/components/Header\";\r\nimport UserService from \"@/services/user.service\";\r\nimport message from \"@/views/components/message\";\r\n\r\nimport DatePicker from 'vue2-datepicker';\r\nimport 'vue2-datepicker/index.css';\r\nimport 'vue2-datepicker/locale/es/ru.js';\r\n\r\n\r\nexport default {\r\n  name: \"Salary\",\r\n  data(){\r\n\r\n    return{\r\n      message: '',\r\n\r\n      showMessage: false,\r\n\r\n      sortKey: \"\",\r\n      sortOrders: {},\r\n      searchQuery: \"\",\r\n      gridColumns: [\"name\", \"position\", \"absenceDays\", \"salary\", \"award\", \"result\"],\r\n      gridLocaleColumns: [\"ФИО\", \"Должность\", \"Пропуски\", \"Зарплата\", \"Премия\", \"Итого\"],\r\n\r\n      gridData: [],\r\n      gridData1: [\r\n        { name: \"Chuck Norris\", power: Infinity },\r\n        { name: \"Bruce Lee\", power: 9000 },\r\n        { name: \"Jackie Chan\", power: 7000 },\r\n        { name: \"Jet Li\", power: 8000 }\r\n      ],\r\n\r\n      selectedDate: new Date(new Date()),\r\n\r\n      premiumBudget: 0,\r\n\r\n      users: [],\r\n\r\n      user:{\r\n        firstName: '',\r\n        profilePicture: '',\r\n        gender: false\r\n      },\r\n\r\n      lang: {\r\n        formatLocale: {\r\n          months: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'],\r\n        }\r\n      }\r\n    };\r\n  },\r\n  components:{\r\n    DatePicker,\r\n    'v-menu' : Menu,\r\n    'v-header': Header,\r\n    'v-message': message\r\n  },\r\n  computed: {\r\n    remainPremiumBudget(){\r\n      let res = this.premiumBudget\r\n      this.gridData.forEach(i => res-=i.award.amount);\r\n      return res;\r\n    },\r\n\r\n    filteredHeroes: function() {\r\n      var sortKey = this.sortKey;\r\n      var filterKey = this.searchQuery && this.searchQuery.toLowerCase();\r\n      var order = this.sortOrders[sortKey] || 1;\r\n      var heroes = this.gridData;\r\n      if (filterKey) {\r\n        heroes = heroes.filter(function(row) {\r\n          return Object.keys(row).some(function(key) {\r\n            return (\r\n                String(row[key])\r\n                    .toLowerCase()\r\n                    .indexOf(filterKey) > -1\r\n            );\r\n          });\r\n        });\r\n      }\r\n      if (sortKey) {\r\n        heroes = heroes.slice().sort(function(a, b) {\r\n          a = a[sortKey];\r\n          b = b[sortKey];\r\n          return (a === b ? 0 : a > b ? 1 : -1) * order;\r\n        });\r\n      }\r\n      return heroes;\r\n    },\r\n\r\n    currentUser() {\r\n      return this.$store.state.auth.user;\r\n    },\r\n    isUserAdmin() {\r\n      if (this.currentUser && this.currentUser.roles) {\r\n        return this.currentUser.roles.includes('ROLE_ADMIN');\r\n      }\r\n\r\n      return false;\r\n    },\r\n    isUserAccountant() {\r\n      if (this.currentUser && this.currentUser.roles) {\r\n        return this.currentUser.roles.includes('ROLE_ACCOUNTANT');\r\n      }\r\n\r\n      return false;\r\n    }\r\n  },\r\n  filters: {\r\n    capitalize: function(str) {\r\n      return str.charAt(0).toUpperCase() + str.slice(1);\r\n    }\r\n  },\r\n  methods: {\r\n    close(){\r\n      this.showMessage = false;\r\n      this.message = ''\r\n    },\r\n    changeSalary(user){\r\n      if (this.remainPremiumBudget < 0){\r\n        user.award.amount = 0;\r\n        this.message = \"Вы вышли за пределы премиального бюджета\"\r\n        this.showMessage = true;\r\n      }\r\n      user.result = ((parseFloat(user.salary) + parseFloat(user.award.amount))*0.87).toFixed(2);\r\n      user.award.month = this.selectedDate;\r\n      UserService.changeAwards(user).then(\r\n          response => {\r\n            user.award = response.data;\r\n          },\r\n          error=>{\r\n            this.message =\r\n                (error.response && error.response.data && error.response.data.message) ||\r\n                error.message ||\r\n                error.toString();\r\n          }\r\n      )\r\n\r\n    },\r\n    isFloat(n){\r\n      return Number(n) === n && n % 1 !== 0;\r\n    },\r\n    sortBy: function(index) {\r\n      let key = this.gridColumns[index];\r\n      this.sortKey = key;\r\n      this.sortOrders[key] = this.sortOrders[key] * -1;\r\n    },\r\n    changeUser(){\r\n      UserService.changeUser(this.currentUser.id, this.user).then(\r\n          response => {\r\n            response.data;\r\n          },\r\n          error => {\r\n            this.message =\r\n                (error.response && error.response.data && error.response.data.message) ||\r\n                error.message ||\r\n                error.toString();\r\n          }\r\n      );\r\n    },\r\n\r\n\r\n    getSalary(){\r\n      UserService.getSalary(this.selectedDate).then(\r\n          response => {\r\n            this.gridData = this.isUserAccountant ? response.data : response.data.filter(i => i.id === this.currentUser.id);\r\n\r\n            this.gridData.forEach(i => i.result = (i.salary + i.award.amount)*0.87)\r\n          },\r\n          error => {\r\n            this.message =\r\n                (error.response && error.response.data && error.response.data.message) ||\r\n                error.message ||\r\n                error.toString();\r\n          }\r\n      );\r\n      UserService.getBudget(this.selectedDate).then(\r\n          response => {\r\n            this.premiumBudget = response.data.amount;\r\n          },\r\n          error => {\r\n            this.message =\r\n                (error.response && error.response.data && error.response.data.message) ||\r\n                error.message ||\r\n                error.toString();\r\n          }\r\n      );\r\n    }\r\n  },\r\n  mounted() {\r\n    if (!this.currentUser) {\r\n      this.$router.push('/login');\r\n    }\r\n\r\n    let sortOrders = {};\r\n    this.gridColumns.forEach(function(key) {\r\n      sortOrders[key] = 1;\r\n    });\r\n    this.sortOrders = sortOrders;\r\n\r\n    UserService.getUser(this.currentUser.id).then(\r\n        response => {\r\n          this.user = response.data;\r\n          this.user.birthday = new Date(response.data.birthday);\r\n        },\r\n        error => {\r\n          this.message =\r\n              (error.response && error.response.data && error.response.data.message) ||\r\n              error.message ||\r\n              error.toString();\r\n        }\r\n    );\r\n    this.getSalary();\r\n  }\r\n}\r\n</script>"]}]}