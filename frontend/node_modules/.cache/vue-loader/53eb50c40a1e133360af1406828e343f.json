{"remainingRequest":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\University\\SoftDevTech\\Salary\\frontend\\src\\views\\Profile.vue?vue&type=style&index=0&id=ced23842&scoped=true&lang=css&","dependencies":[{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\src\\views\\Profile.vue","mtime":1637430430836},{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\University\\SoftDevTech\\Salary\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n.mx-datepicker{\n  width: fit-content;\n}\n.alert-error{\n  text-align: left;\n  padding-left: 15px;\n}\n",{"version":3,"sources":["Profile.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Profile.vue","sourceRoot":"src/views","sourcesContent":["<style scoped>\n.mx-datepicker{\n  width: fit-content;\n}\n.alert-error{\n  text-align: left;\n  padding-left: 15px;\n}\n</style>\n<template>\n  <div v-if=\"currentUser\"><v-header\n      v-bind:user=\"{\n        firstName: user.firstName,\n        profilePicture: user.profilePicture,\n        gender: user.gender\n      }\"></v-header>\n  <div class=\"container\">\n\n\n    <v-menu></v-menu>\n\n    <div class=\"content\" style=\"max-width: 200px;\">\n      <div style=\"position: relative\">\n        <input\n            class=\"image-picker\"\n            type=\"file\"\n            accept=\"image/*\"\n            @change=\"onImageSelected\"\n        />\n        <img class=\"profile-picture\"\n             :src=\"user.profilePicture ?\n           require('../../public/images/store/'+user.profilePicture) :\n           require('../../public/images/default'+(user.gender ? 'Woman':'Man')+'.png')\" alt=\"profile picture\"/>\n      </div>\n\n\n      <div class=\"row\" style=\"background-color: #dfe6ed; margin-bottom: 0; padding: 5px; border-radius: 3px; justify-content: center;\">\n        {{hasRole}}\n      </div>\n      <div v-if=\"message\" class=\"row\" style=\"margin-bottom: 0; word-break:break-all ;color: #ff6464; justify-content: center\">{{message}}</div>\n    </div>\n    <div class=\"content\" style=\"width: calc(80% - 15% - 285px)\">\n      <div>\n        <div class=\"row\" style=\"margin: 0 15px\">\n          <input class=\"username\" type=\"text\" maxlength=\"30\" v-autowidth=\"{maxWidth: '700px', minWidth: '20px', comfortZone: 0}\" v-model=\"user.lastName\" @change=\"changeUser\">\n          <input class=\"username\" type=\"text\" maxlength=\"30\" v-autowidth=\"{maxWidth: '700px', minWidth: '20px', comfortZone: 0}\" v-model=\"user.firstName\" @change=\"changeUser\">\n          <input class=\"username\" type=\"text\" maxlength=\"30\" v-autowidth=\"{maxWidth: '700px', minWidth: '20px', comfortZone: 0}\" v-model=\"user.patronymic\" @change=\"changeUser\">\n        </div>\n        <div class=\"separator\"></div>\n        <div class=\"row\">\n          <div class=\"column\">\n            <div class=\"row user-info\">Почта:</div>\n            <div class=\"row user-info\">День рождения:</div>\n            <div class=\"row user-info\">Пол:</div>\n          </div>\n          <div class=\"column\">\n            <div class=\"row\">{{user.email}}</div>\n            <div class=\"row\">\n              <date-picker v-model=\"user.birthday\"\n                           @change=\"changeUser\"\n                         type=\"date\"\n                         format=\"DD MMMM YYYY г.\" :lang=\"lang\"\n                         :clearable = \"false\"\n                         :confirm=\"true\"\n                         input-class=\"date-picker\"\n                         placeholder=\"Выбрать\">\n              </date-picker>\n            </div>\n            <div class=\"row\" style=\"margin: calc(15px - 5px) 0; text-align: center;\">\n              <span v-bind:style=\"[user.gender ? {'background': 'none'} : {'background': 'rgb(223, 230, 237)'}]\"\n                    @click=\"user.gender=false; changeUser()\"\n                    class=\"material-icons square-border-button\">\n                man\n              </span>\n              <div style=\"width: 100%;\">{{user.gender ? 'Женский' : 'Мужской'}}</div>\n              <span v-bind:style=\"[user.gender ? {'background': 'rgb(223, 230, 237)'} : {'background': 'none'}]\"\n                    @click=\"user.gender=true; changeUser()\"\n                    class=\"material-icons square-border-button\">\n                woman\n              </span>\n            </div>\n          </div>\n        </div>\n        <div class=\"separator\"></div>\n        <div v-if=\"user.workerInfo\">\n          <div class=\"row\">\n            <div class=\"column\">\n              <div class=\"row user-info\">Семейное положение:</div>\n              <div class=\"row user-info\">Количество детей:</div>\n            </div>\n            <div class=\"column\">\n              <div class=\"row\">\n                <div v-click-outside=\"deactivateSelectFocus\" style=\"position: relative; width: fit-content; min-width: 6em; padding-right: 20px\">\n                  <div @click=\"selectFocus=!selectFocus\" style=\"display: flex; justify-content: space-between;\">\n                    <div style=\"margin-right: 5px\">{{maritalStatus[user.workerInfo ? (user.workerInfo.maritalStatus % 3):0]}}</div>\n                    <span class=\"material-icons\" v-bind:style=\"{ 'padding-right': '0px', transform: 'rotate('+ (selectFocus ? '90':'0')+'deg)'}\">chevron_right</span>\n                  </div>\n                  <div class=\"select\" v-bind:style=\"[selectFocus ? {display:'block'} : {display: 'none'}]\">\n                    <div @click=\"selectFocus=!selectFocus\">Placeholder</div>\n                    <div v-for=\"(status, index) in maritalStatus\" :key=\"index\"\n                         @click=\"()=>{user.workerInfo.maritalStatus=index; deactivateSelectFocus(); changeUser()}\">\n                      {{status}}\n                    </div>\n                  </div>\n\n                </div>\n              </div>\n              <div class=\"row\" style=\"padding-right: 20px\">\n                <div><span\n                    style=\"display: block; background-color: rgb(223, 230, 237); border-radius: 3px; padding: 0; cursor: pointer\"\n                    @click=\"()=>{if(user.workerInfo.children > 0) {user.workerInfo.children-=1; changeUser()}}\"\n                    class=\"material-icons unselectable\">remove</span>\n                </div>\n                <div style=\"padding: 0 10px; width: 100%; text-align: center\">{{user.workerInfo.children}}</div>\n                <div><span\n                    style=\"display: block; background-color: rgb(223, 230, 237); border-radius: 3px; padding: 0; cursor: pointer\"\n                    @click=\"()=>{if(user.workerInfo.children < 10) {user.workerInfo.children+=1; changeUser()}}\"\n                    class=\"material-icons unselectable\">add</span>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div class=\"separator\"></div>\n        </div>\n        <div v-click-outside=\"deactivatePasswordFocus\" v-bind:class=\"[passwordFocus ? 'active-block' : '', 'column']\">\n\n          <div v-if=\"response && passwordFocus\" class=\"alert-error\">{{response}}</div>\n          <div class=\"row\">\n            <div class=\"user-info\">Старый пароль:</div>\n            <input type=\"password\"\n                   class=\"border-input\"\n                   v-on:focus=\"passwordFocus = true\"\n                   v-model=\"oldPassword\"/>\n          </div>\n          <div class=\"row\">\n            <div class=\"user-info\">Новый пароль:</div>\n            <input type=\"password\"\n                   class=\"border-input\"\n                   v-on:focus=\"passwordFocus = true\"\n                   v-model=\"newPassword\" name=\"пароль\"\n                   v-validate=\"'required|min:6|max:40'\"/>\n          </div>\n          <div class=\"alert-error\" v-if=\"this.newPassword.includes(' ') && passwordFocus\">Пароль не может содержать пробелы</div>\n          <div\n              v-else-if=\"errors.has('пароль') && passwordFocus\"\n              class=\"alert-error\">\n            {{errors.first('пароль')}}\n          </div>\n          <div class=\"row\">\n            <div class=\"user-info\">Повторите новый пароль:</div>\n            <input type=\"password\"\n                   class=\"border-input\"\n                   v-on:focus=\"passwordFocus = true\"\n                   v-model=\"checkedPassword\"/>\n          </div>\n          <div v-if=\"notSamePasswords && passwordFocus\" class=\"alert-error\">Пароли не совпадают</div>\n          <div class=\"row\">\n            <div class=\"user-info\"></div>\n            <div class=\"btn btn-thin\" style=\"margin: 0\" @click=\"changePassword\">Сменить пароль</div>\n          </div>\n\n        </div>\n        <div class=\"separator\"></div>\n      </div>\n      <div class=\"row\">\n        <button class=\"btn\" style=\"margin: 15px\" @click.prevent=\"logOut\">\n          Выйти\n        </button>\n      </div>\n\n        <!-- END -->\n\n      </div>\n  </div>\n  </div>\n</template>\n\n<script>\nimport UserService from '../services/user.service';\nimport Menu from \"@/views/components/Menu\";\nimport Header from \"@/views/components/Header\";\n\nimport DatePicker from 'vue2-datepicker';\nimport 'vue2-datepicker/index.css';\nimport 'vue2-datepicker/locale/es/ru.js';\n\nexport default {\n  name: 'Profile',\n  data(){\n    return{\n      message: '',\n      user:{\n        id:'',\n        email:'',\n        firstName:'',\n        lastName:'',\n        patronymic: '',\n        birthday: new Date(),\n        gender: false,\n        profilePicture: '',\n\n        workerInfo:{\n          maritalStatus: 0,\n          children: 0\n        }\n      },\n\n      selectedProfilePicture: null,\n\n      selectFocus: false,\n      passwordFocus: false,\n\n      oldPassword: '',\n      newPassword: '',\n      checkedPassword: '',\n      response: '',\n\n      lang: {\n        formatLocale: {\n          months: ['января', 'февраля', 'марта', 'апреля', 'мая', 'июня', 'июля', 'августа', 'сентября', 'октября', 'ноября', 'декабря'],\n        }\n      },\n    };\n  },\n  components:{\n    DatePicker,\n    'v-menu' : Menu,\n    'v-header': Header\n  },\n  computed: {\n    currentUser() {\n      return this.$store.state.auth.user;\n    },\n    isUserAdmin() {\n      if (this.currentUser && this.currentUser.roles) {\n        return this.currentUser.roles.includes('ROLE_ADMIN');\n      }\n\n      return false;\n    },\n    isUserAccountant() {\n      if (this.currentUser && this.currentUser.roles) {\n        return this.currentUser.roles.includes('ROLE_ACCOUNTANT');\n      }\n\n      return false;\n    },\n    hasRole(){\n      if (this.currentUser.roles.includes('ROLE_ADMIN')) return 'Администратор';\n      if (this.currentUser.roles.includes('ROLE_ACCOUNTANT')) return 'Бухгалтер';\n      if (this.currentUser.roles.includes('ROLE_USER')) return 'Сотрудник';\n      return 0;\n\n    },\n    maritalStatus(){\n      return [\n        this.user.gender ? 'Не замужем': 'Не женат',\n        this.user.gender ? 'Замужем': 'Женат',\n        this.user.gender ? 'Разведена': 'Разведен'\n      ]\n    },\n\n\n    notSamePasswords () {\n      if (this.newPassword !== '' && this.checkedPassword !== '') {\n        return (this.newPassword !== this.checkedPassword)\n      } else {\n        return false\n      }\n    },\n  },\n\n  methods: {\n    onImageSelected(event) {\n      let formData = new FormData();\n      let file = event.target.files[0];\n      formData.append(\"profilePicture\", file, file.name);\n      UserService.uploadProfilePicture(this.currentUser.id, formData).then(\n          response => {\n            this.user.profilePicture = response.data.profilePicture;\n          },\n          error => {\n            // eslint-disable-next-line no-console\n            console.log(error);\n          }\n      );\n    },\n\n    deactivatePasswordFocus(){\n      this.passwordFocus=false;\n    },\n    deactivateSelectFocus(){\n      this.selectFocus=false;\n    },\n    changePassword(){\n      this.passwordFocus = true;\n      if (!this.notSamePasswords && this.newPassword !== '' && this.checkedPassword !== ''){\n        this.$validator.validate().then(isValid => {\n          if (isValid && !this.newPassword.includes(' ')) {\n            UserService.changePassword(this.currentUser.id,this.oldPassword,this.newPassword).then(\n                response => {\n                  if (response.data){\n                    this.response = 'Пароль был успешно изменен';\n                  } else {\n                    this.response = \"Неверный старый пароль пароль\";\n                  }\n                }\n            );\n          }\n        });\n      } else this.response = 'Заполните все поля'\n    },\n    changeUser(){\n      UserService.changeUser(this.currentUser.id, this.user).then(\n          response => {\n            response.data;\n          },\n          error => {\n            this.message =\n                (error.response && error.response.data && error.response.data.message) ||\n                error.message ||\n                error.toString();\n          }\n      );\n    },\n    logOut() {\n      this.$store.dispatch('auth/logout');\n      this.$router.push('/login');\n    }\n  },\n  mounted() {\n    if (!this.currentUser) {\n      this.$router.push('/login');\n    }\n    UserService.getUser(this.currentUser.id).then(\n        response => {\n          this.user = response.data;\n          this.user.birthday = new Date(response.data.birthday);\n        },\n        error => {\n          this.message =\n              (error.response && error.response.data && error.response.data.message) ||\n              error.message ||\n              error.toString();\n        }\n    );\n\n\n  }\n};\n</script>"]}]}